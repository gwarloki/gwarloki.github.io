{"title":"Docker安装LogonTracer","uid":"ad55f03212de97d27b0493e8951fccaf","slug":"Docker安装LogonTracer","date":"2021-07-28T09:13:17.000Z","updated":"2022-11-02T07:08:16.477Z","comments":true,"path":"api/articles/Docker安装LogonTracer.json","keywords":null,"cover":"https://gtwallpaper.org/sites/default/files/wallpaper/159420/4k-dramatic-sunset-over-blidinje-wallpapers-159420-21778-136755.png","content":"<h1 id=\"LogonTracer介绍\"><a href=\"#LogonTracer介绍\" class=\"headerlink\" title=\"LogonTracer介绍\"></a>LogonTracer介绍</h1><p>LogonTracer：是一款用于可视化分析Windows安全事件日志寻找恶意登录的工具。它会将登录相关事件中找到的主机名（或IP地址）和帐户名称关联起来，并将其以图形化的方式展现出来。通过这种方式，可以看到哪个帐户中发生过登录尝试以及哪个主机被使用。基于此研究，该工具可以可视化与Windows登录相关的下列事件ID。</p>\n<pre class=\"line-numbers language-事件ID\" data-language=\"事件ID\"><code class=\"language-事件ID\">4624：登录成功\n \n4625：登录失败\n \n4768：Kerberos身份验证（TGT请求）\n \n4769：Kerberos服务票据（ST请求）\n \n4776：NTLM身份验证\n \n4672：分配特殊权限</code></pre>\n\n<pre class=\"line-numbers language-登录类型描述\" data-language=\"登录类型描述\"><code class=\"language-登录类型描述\">2 互动(键盘和屏幕的登录系统)\n \n3 网络(即连接到共享文件夹从其他地方在这台电脑上网络)\n \n4 批处理(即计划任务)\n \n5 服务(服务启动)\n \n7 解锁密码保护屏幕保护程序(即unnattended工作站)\n \n8 NetworkCleartext(登录凭据发送明文。通常表示与“基本身份验证”登录到IIS)\n \n9 NewCredentials如RunAs或映射网络驱动器替代凭证。这个登录类型似乎并没有出现在任何事件。\n \n10 RemoteInteractive(终端服务,远程桌面或远程协助)\n \n11 CachedInteractive(与缓存域登录凭证时登录一台笔记本电脑等远离网络)</code></pre>\n<h1 id=\"作用\"><a href=\"#作用\" class=\"headerlink\" title=\"作用\"></a>作用</h1><p>LogonTracer使用 PageRank和ChangeFinder从事件日志中检测恶意主机和帐户。<br>使用LogonTracer，也可以按时间顺序显示事件日志。</p>\n<h1 id=\"搭建\"><a href=\"#搭建\" class=\"headerlink\" title=\"搭建\"></a>搭建</h1><p>1.拉取镜像文件</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">docker pull jpcertcc&#x2F;docker-logontracer</code></pre>\n<p>2.运行镜像</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">docker run --detach --publish&#x3D;7474:7474 --publish&#x3D;7687:7687 --publish&#x3D;8080:8080 -e LTHOSTNAME&#x3D;172.17.190.98 jpcertcc&#x2F;docker-logontracer</code></pre>\n<p>3.修改项目前端问题</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">#1.编辑镜像模板文件\ndocker exec -it 349d &#x2F;bin&#x2F;sh\n&#x2F;var&#x2F;lib&#x2F;neo4j# vi &#x2F;usr&#x2F;local&#x2F;src&#x2F;LogonTracer&#x2F;templates&#x2F;index.html\n#2.替换国内JS源文件\nhttps:&#x2F;&#x2F;ajax.googleapis.com&#x2F;ajax&#x2F;libs&#x2F;jquery&#x2F;3.2.1&#x2F;jquery.min.js -&gt; 替换成https:&#x2F;&#x2F;ajax.loli.net&#x2F;ajax&#x2F;libs&#x2F;jquery&#x2F;3.2.1&#x2F;jquery.min.js\n#3.若还有JS资源问题如cdnjs.cloudflare.com等可使用猫云搜索对应JS并替换。\n#4.重启容器\ndocker restart id [[容器ID]]</code></pre>\n<p>4.本地通过Python脚本导入文件</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">docker cp &#x2F;home&#x2F;issue_38.evtx c0384389919d:&#x2F;usr&#x2F;local&#x2F;src&#x2F;LogonTracer #拷贝文件到容器内\ncd &#x2F;usr&#x2F;local&#x2F;src&#x2F;LogonTracer &amp;&amp; python3 logontracer.py --delete -e log.evtx -u neo4j -p password #本地导入文件</code></pre>\n<p>5.Neo4J数据库</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">http:&#x2F;&#x2F;localhost:7474 #地址\n账号：neo4j\n密码：password</code></pre>\n<p>6.docker操作</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">1）commit的错误操作\ndocker commit c0384389919d jpcertcc&#x2F;docker-logontracer-v2 [[commit]]\ndocker commit 后无法删除原有镜像文件，查看image的父images命令：\ndocker image inspect --format&#x3D;&#39;&#123;&#123;.RepoTags&#125;&#125; &#123;&#123;.Id&#125;&#125; &#123;&#123;.Parent&#125;&#125;&#39; $(docker image ls -q --filter since&#x3D;子镜像id)\n2）镜像保存后导出导入\ndocker save jpcertcc&#x2F;docker-logontracer&#x2F;root&#x2F;home&#x2F;jpcertcc.tar\ndocker load&lt;jpcertcc.tar\n3)容器内安装工具\napt-get install -y net-tools #网络工具\napt-get install -y vim #编辑工具\napt-get update &amp;&amp; apt-get install procps #进程管理工具\n4)手动启动web\npython3 logontracer.py -r -o 8080 -u neo4j -p password -s localhost</code></pre>\n<h1 id=\"资源链接\"><a href=\"#资源链接\" class=\"headerlink\" title=\"资源链接\"></a>资源链接</h1><p><a href=\"https://www.bootcdn.cn/\">猫云</a><br><a href=\"https://github.com/JPCERTCC/LogonTracer\">github地址</a><br><a href=\"https://neo4j.com/docs/operations-manual/4.0/docker/configuration/\">neo4j文档</a>   </p>\n","text":"LogonTracer介绍LogonTracer：是一款用于可视化分析Windows安全事件日志寻找恶意登录的工具。它会将登录相关事件中找到的主机名（或IP地址）和帐户名称关联起来，并将其以图形化的方式展现出来。通过这种方式，可以看到哪个帐户中发生过登录尝试以及哪个主机被使用。基...","link":"","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[{"name":"应急响应","slug":"应急响应","count":1,"path":"api/categories/应急响应.json"}],"tags":[{"name":"日志分析","slug":"日志分析","count":2,"path":"api/tags/日志分析.json"},{"name":"应急响应","slug":"应急响应","count":2,"path":"api/tags/应急响应.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#LogonTracer%E4%BB%8B%E7%BB%8D\"><span class=\"toc-text\">LogonTracer介绍</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BD%9C%E7%94%A8\"><span class=\"toc-text\">作用</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%90%AD%E5%BB%BA\"><span class=\"toc-text\">搭建</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E8%B5%84%E6%BA%90%E9%93%BE%E6%8E%A5\"><span class=\"toc-text\">资源链接</span></a></li></ol>","author":{"name":"Moses","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一位正在重塑知识的技术人","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Kubernetes学习笔记 -- kubeadm-ha安装集群","uid":"f443264b00bffe4f0b17c0513a02db89","slug":"Kuboard","date":"2021-08-15T16:00:00.000Z","updated":"2022-11-02T02:56:58.613Z","comments":true,"path":"api/articles/Kuboard.json","keywords":null,"cover":"https://gtwallpaper.org/sites/default/files/wallpaper/159420/4k-dramatic-sunset-over-blidinje-wallpapers-159420-21735-6813944.png","text":"在K8S 中安装 Kuboard v3方法一：使用 hostPath 提供持久化安装1.执行 Kuboard v3 在 K8S 中的安装 kubectl apply -f https:&#x2F;&#x2F;addons.kuboard.cn&#x2F;kuboard&#x2F;...","link":"","photos":[],"count_time":{"symbolsCount":"1.2k","symbolsTime":"1 mins."},"categories":[{"name":"Cloud-Native","slug":"Cloud-Native","count":6,"path":"api/categories/Cloud-Native.json"}],"tags":[{"name":"Kubernetes","slug":"Kubernetes","count":3,"path":"api/tags/Kubernetes.json"},{"name":"k8s-dashboard","slug":"k8s-dashboard","count":3,"path":"api/tags/k8s-dashboard.json"},{"name":"Docker","slug":"Docker","count":2,"path":"api/tags/Docker.json"},{"name":"kuboard","slug":"kuboard","count":1,"path":"api/tags/kuboard.json"}],"author":{"name":"Moses","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一位正在重塑知识的技术人","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"容器安全平台-Habor-Scanner","uid":"4a5feac766d456074a0922c23a83b4df","slug":"容器镜像安全-Habor-scanner","date":"2021-04-05T18:16:02.000Z","updated":"2022-10-27T02:15:23.452Z","comments":true,"path":"api/articles/容器镜像安全-Habor-scanner.json","keywords":null,"cover":"https://gtwallpaper.org/sites/default/files/wallpaper/159413/4k-aurora-wallpapers-159413-3526-9533250.png","text":"Harbor-Scanner一个免费的镜像漏洞扫描工具, 可以扫描镜像中已安装软件包的漏洞，支持中文漏洞库，可与 Harbor 无缝集成。 Dosec 的商业客户可以使用企业版扫描功能，例如扫描开源框架中的漏洞以及扫描容器镜像中包含的敏感数据。同时企业版增加了WEB UI, 提供...","link":"","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[{"name":"Cloud-Native-Security","slug":"Cloud-Native-Security","count":12,"path":"api/categories/Cloud-Native-Security.json"}],"tags":[{"name":"镜像安全","slug":"镜像安全","count":3,"path":"api/tags/镜像安全.json"},{"name":"云原生安全","slug":"云原生安全","count":6,"path":"api/tags/云原生安全.json"},{"name":"容器安全平台","slug":"容器安全平台","count":5,"path":"api/tags/容器安全平台.json"},{"name":"产品选型","slug":"产品选型","count":6,"path":"api/tags/产品选型.json"},{"name":"harbor","slug":"harbor","count":1,"path":"api/tags/harbor.json"}],"author":{"name":"Moses","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一位正在重塑知识的技术人","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}