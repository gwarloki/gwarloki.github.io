{"title":"开源WAF调研之产品选型-Nginx+ModSecurity3.0","uid":"35772fd534664d45a9bf135dc04685bc","slug":"开源WAF选型-Nginx+ModSecurity3.0","date":"2022-06-09T06:39:16.000Z","updated":"2022-10-26T10:10:07.278Z","comments":true,"path":"api/articles/开源WAF选型-Nginx+ModSecurity3.0.json","keywords":null,"cover":"https://gtwallpaper.org/sites/default/files/wallpaper/159446/abrams-falls-wallpapers-159446-1969-4235097.png","content":"<h1 id=\"产品信息简介\"><a href=\"#产品信息简介\" class=\"headerlink\" title=\"产品信息简介\"></a>产品信息简介</h1><table>\n<thead>\n<tr>\n<th>名称</th>\n<th>开源协议</th>\n<th>开发语言</th>\n<th>开源时间</th>\n<th>活跃度</th>\n<th>代码质量</th>\n<th>最新版本</th>\n<th>厂商</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>ModSecurity</td>\n<td>BSD 3-Clause License</td>\n<td>Lua</td>\n<td>2013-12-16（2.7.6）</td>\n<td>5.4K⭐️</td>\n<td>A</td>\n<td>2022-05-31 （3.1.7）</td>\n<td>Trustwave</td>\n</tr>\n</tbody></table>\n<h1 id=\"ModSecurity介绍\"><a href=\"#ModSecurity介绍\" class=\"headerlink\" title=\"ModSecurity介绍\"></a>ModSecurity介绍</h1><p>ModSecurity是一个开源的、生产级别的WAF产品，核心组成部分是“规则引擎”和“规则集”，两者的关系有点像杀毒引擎和病毒特征库。</p>\n<ul>\n<li><p>规则引擎：实现了自定义的”SecRule”语言，有自己特定的语法。但“SecRule”主要基于正则表达式，还是不够灵活，所以后来引入了Lua,实现了脚本化配置。ModSecurity的规则引擎使用C++11实现，可以从<a href=\"https://github.com/SpiderLabs/ModSecurity\">GitHub</a>上下载，然后集成进Nginx。因为他比较庞大，编译很费时间，所以最好编译成动态模块，在配置文件中用指令<code>load_module</code>加载</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">load_module modules&#x2F;ngx_http_mod</code></pre>\n</li>\n<li><p>规则集：ModSecurity 源码提供一个基本的规则配置文件“modsecurity.conf-recommended”，使用前要把它的后缀改成“conf”。有了规则集，就可以在 Nginx 配置文件里加载，然后启动规则引擎：<code>modsecurity on;modsecurity_rules_file /path/to/modsecurity.conf;“modsecurity.conf”</code>文件默认只有检测功能，不提供入侵阻断，这是为了防止误杀误报，把“SecRuleEngine”后面改成“On”就可以开启完全的防护：<code>#SecRuleEngine DetectionOnlySecRuleEngine On</code>除了基本的规则集之外，ModSecurity 还额外提供一个更完善的规则集，为网站提供全面可靠的保护。这个规则集的全名叫“OWASP ModSecurity 核心规则集”<a href=\"https://github.com/SpiderLabs/owasp-modsecurity-crs\">CRS</a></p>\n</li>\n</ul>\n<h1 id=\"功能\"><a href=\"#功能\" class=\"headerlink\" title=\"功能\"></a>功能</h1><ul>\n<li>兼容 <a href=\"https://github.com/SpiderLabs/ModSecurity\">ModSecurity (opens new window)</a>。此功能仅限最新的 Current 版本。</li>\n<li>SQL 注入防护（Powered By <a href=\"https://github.com/libinjection/libinjection\">libinjection (opens new window)</a>）。</li>\n<li>XSS 攻击防护（Powered By <a href=\"https://github.com/libinjection/libinjection\">libinjection (opens new window)</a>）。</li>\n<li>支持 IPV4 和 IPV6。</li>\n<li>支持开启验证码（CAPTCHA)，支持 <a href=\"https://www.hcaptcha.com/\">hCaptcha (opens new window)</a>、<a href=\"https://developers.google.com/recaptcha\">reCAPTCHAv2 (opens new window)</a>和 <a href=\"https://developers.google.com/recaptcha\">reCAPTCHAv3 (opens new window)</a>。</li>\n<li>支持识别友好爬虫（如 BaiduSpider）并自动放行（基于 User-Agent 和 IP 的识别）。此功能仅限最新的 Current 版本。</li>\n<li>CC 防御，超出限制后自动拉黑对应 IP 一段时间或者使用验证码做人机识别。</li>\n<li>IP 黑白名单，同时支持类似 <code>192.168.0.0/16</code> 和 <code>fe80::/10</code>，即支持点分十进制和冒号十六进制表示法和网段划分。</li>\n<li>POST 黑名单。</li>\n<li>URL 黑白名单</li>\n<li>查询字符串（Query String）黑名单。</li>\n<li>UserAgent 黑名单。</li>\n<li>Cookie 黑名单。</li>\n<li>Referer 黑白名单。</li>\n</ul>\n<h2 id=\"ModSecurity功能\"><a href=\"#ModSecurity功能\" class=\"headerlink\" title=\"ModSecurity功能\"></a>ModSecurity功能</h2><ul>\n<li>SQL Injection (SQLi)：阻止SQL注入</li>\n<li>Cross Site Scripting (XSS)：阻止跨站脚本攻击</li>\n<li>Local File Inclusion (LFI)：阻止利用本地文件包含漏洞进行攻击</li>\n<li>Remote File Inclusione(RFI)：阻止利用远程文件包含漏洞进行攻击</li>\n<li>Remote Code Execution (RCE)：阻止利用远程命令执行漏洞进行攻击</li>\n<li>PHP Code Injectiod：阻止PHP代码注入</li>\n<li>HTTP Protocol Violations：阻止违反HTTP协议的恶意访问</li>\n<li>HTTPoxy：阻止利用远程代理感染漏洞进行攻击</li>\n<li>shellshock：阻止利用Shellshock漏洞进行攻击</li>\n<li>Session Fixation：阻止利用Session会话ID不变的漏洞进行攻击</li>\n<li>Scanner Detection：阻止黑客扫描网站</li>\n<li>Metadata&#x2F;Error Leakages：阻止源代码&#x2F;错误信息泄露</li>\n<li>Project Honey Pot Blacklist：蜜罐项目黑名单</li>\n<li>GeoIP Country Blocking：根据判断IP地址归属地来进行IP阻断</li>\n</ul>\n<h1 id=\"准备环境\"><a href=\"#准备环境\" class=\"headerlink\" title=\"准备环境\"></a>准备环境</h1><ul>\n<li>操作系统：<a href=\"http://archive.kernel.org/centos-vault/7.6.1810/isos/x86_64/CentOS-7-x86_64-DVD-1810.iso\">CentOS-7-x86_64-DVD-1810.iso</a></li>\n<li>ModSecurity：3.0</li>\n<li>Nginx：1.16.1</li>\n<li>虚拟机：vwareFusion12.2.1 桥接</li>\n</ul>\n<h1 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h1><h3 id=\"操作系统依赖\"><a href=\"#操作系统依赖\" class=\"headerlink\" title=\"操作系统依赖\"></a>操作系统依赖</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">yum install -y git wget epel-release\nyum install -y gcc-c++ flex bison yajl yajl-devel curl-devel curl GeoIP-devel doxygen zlib-devel pcre-devel lmdb-devel libxml2-devel ssdeep-devel lua-devel libtool autoconf automake</code></pre>\n<h3 id=\"安装ModSecurity\"><a href=\"#安装ModSecurity\" class=\"headerlink\" title=\"安装ModSecurity\"></a>安装ModSecurity</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">cd &#x2F;usr&#x2F;local\ngit clone https:&#x2F;&#x2F;github.com&#x2F;SpiderLabs&#x2F;ModSecurity\ncd ModSecurity\ngit checkout -b v3&#x2F;master origin&#x2F;v3&#x2F;master\ngit submodule init\ngit submodule update\nsh build.sh\n.&#x2F;configure\n# 输出\nModSecurity - v3.0.7-1-g9755088 for Linux\n\n Mandatory dependencies\n   + libInjection                                  ....v3.9.2-46-gbfba51f\n   + SecLang tests                                 ....a3d4405\n\n Optional dependencies\n   + GeoIP&#x2F;MaxMind                                 ....found\n      * (GeoIP) v1.5.0\n         -lGeoIP  , -I&#x2F;usr&#x2F;include&#x2F;\n   + LibCURL                                       ....found v7.29.0\n      -lcurl  ,  -DWITH_CURL\n   + YAJL                                          ....found v2.0.4\n      -lyajl  , -DWITH_YAJL\n   + LMDB                                          ....disabled\n   + LibXML2                                       ....found v2.9.1\n      -lxml2 -lz -lm -ldl, -I&#x2F;usr&#x2F;include&#x2F;libxml2 -DWITH_LIBXML2\n   + SSDEEP                                        ....found\n      -lfuzzy -L&#x2F;usr&#x2F;lib64&#x2F;, -DWITH_SSDEEP -I&#x2F;usr&#x2F;include\n   + LUA                                           ....found v501\n      -llua-5.1 -L&#x2F;usr&#x2F;lib64&#x2F;, -DWITH_LUA -DWITH_LUA_5_1 -I&#x2F;usr&#x2F;include\n   + PCRE2                                          ....not found\n\n Other Options\n   + Test Utilities                                ....enabled\n   + SecDebugLog                                   ....enabled\n   + afl fuzzer                                    ....disabled\n   + library examples                              ....enabled\n   + Building parser                               ....disabled\n   + Treating pm operations as critical section    ....disabled\nmake\nmake install</code></pre>\n<h3 id=\"安装Nginx与ModSecurity-nginx\"><a href=\"#安装Nginx与ModSecurity-nginx\" class=\"headerlink\" title=\"安装Nginx与ModSecurity-nginx\"></a>安装Nginx与ModSecurity-nginx</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">cd &#x2F;usr&#x2F;local\ngit clone https:&#x2F;&#x2F;github.com&#x2F;SpiderLabs&#x2F;ModSecurity-nginx\nwget http:&#x2F;&#x2F;nginx.org&#x2F;download&#x2F;nginx-1.16.1.tar.gz\ntar -xvzf nginx-1.16.1.tar.gz\ncd &#x2F;usr&#x2F;local&#x2F;nginx-1.16.1\n.&#x2F;configure --add-module&#x3D;&#x2F;usr&#x2F;local&#x2F;ModSecurity-nginx\nmake\nmake install</code></pre>\n\n<h1 id=\"验证\"><a href=\"#验证\" class=\"headerlink\" title=\"验证\"></a>验证</h1><p>启动Nginx</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx</code></pre>\n<p>验证Nginx服务</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">[root@localhost sbin]# curl -i http:&#x2F;&#x2F;127.0.0.1\nHTTP&#x2F;1.1 200 OK\nServer: nginx&#x2F;1.16.1\nDate: Thu, 09 Jun 2022 08:24:59 GMT\nContent-Type: text&#x2F;html\nContent-Length: 612\nLast-Modified: Thu, 09 Jun 2022 08:23:04 GMT\nConnection: keep-alive\nETag: &quot;62a1ade8-264&quot;\nAccept-Ranges: bytes\n\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;Welcome to nginx!&lt;&#x2F;title&gt;\n&lt;style&gt;\n    body &#123;\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    &#125;\n&lt;&#x2F;style&gt;\n&lt;&#x2F;head&gt;\n&lt;body&gt;\n&lt;h1&gt;Welcome to nginx!&lt;&#x2F;h1&gt;\n&lt;p&gt;If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.&lt;&#x2F;p&gt;\n\n&lt;p&gt;For online documentation and support please refer to\n&lt;a href&#x3D;&quot;http:&#x2F;&#x2F;nginx.org&#x2F;&quot;&gt;nginx.org&lt;&#x2F;a&gt;.&lt;br&#x2F;&gt;\nCommercial support is available at\n&lt;a href&#x3D;&quot;http:&#x2F;&#x2F;nginx.com&#x2F;&quot;&gt;nginx.com&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;\n\n&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;\n&lt;&#x2F;body&gt;\n&lt;&#x2F;html&gt;</code></pre>\n<p>PS：浏览器访问失败，临时关闭防火墙验证</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">[root@localhost sbin] systemctl stop firewalld.service</code></pre>\n<p>浏览器访问<br><img src=\"http://img.moses.wang/20220609163456.png\"></p>\n<h1 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h1><ol>\n<li>创建用于存放配置的文件夹<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">[root@localhost conf]# mkdir &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;modsecurity</code></pre></li>\n<li>复制并重命名配置文件<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">[root@localhost conf] cp &#x2F;usr&#x2F;local&#x2F;ModSecurity&#x2F;modsecurity.conf-recommended &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;modsecurity&#x2F;\n# 重命名配置文件\n[root@localhost] cd &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;modsecurity&#x2F; &amp;&amp; rename modsecurity.conf-recommended modsecurity.conf *\n[root@localhost modsecurity] cp &#x2F;usr&#x2F;local&#x2F;ModSecurity&#x2F;unicode.mapping &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;modsecurity&#x2F;</code></pre></li>\n<li><a href=\"http://www.modsecurity.cn/download/corerule/owasp-modsecurity-crs-3.3-dev.zip\">下载规则文件压缩包</a><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 下载规则包\n[root@localhost local] wget http:&#x2F;&#x2F;www.modsecurity.cn&#x2F;download&#x2F;corerule&#x2F;owasp-modsecurity-crs-3.3-dev.zip\n# 解压\n[root@localhost local] unzip owasp-modsecurity-crs-3.3-dev.zip\n# 复制crs-setup.conf.example\n[root@localhost owasp-modsecurity-crs-3.3-dev] cp crs-setup.conf.example &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;modsecurity&#x2F;\n# 重命名文件\n[root@localhost] cd &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;modsecurity&#x2F; &amp;&amp; rename modsecurity.conf.example crs-setup.conf *\n# 复制rule文件夹\n[root@localhost owasp-modsecurity-crs-3.3-dev] cp -r rules &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;modsecurity&#x2F;\n# 修改文件名,可以将自己写的规则放在999 900这两个文件中\n[root@localhost rules] rename RESPONSE-999-EXCLUSION-RULES-AFTER-CRS.conf.example RESPONSE-999-EXCLUSION-RULES-AFTER-CRS.conf *\n[root@localhost rules] rename REQUEST-900-EXCLUSION-RULES-BEFORE-CRS.conf.example REQUEST-900-EXCLUSION-RULES-BEFORE-CRS.conf *</code></pre></li>\n<li>编辑nginx.conf<br>在http或server节点中添加以下内容<strong>在http节点添加表示全局配置，在server节点添加表示为指定网站配置</strong>：<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">modsecurity on;\nmodsecurity_rules_file &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;modsecurity&#x2F;modsecurity.conf;</code></pre></li>\n<li>编辑modsecurity.conf<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">vim &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;modsecurity&#x2F;modsecurity.conf\n# SecRuleEngine DetectionOnly改为SecRuleEngine On\n# 添加一下内容\nInclude &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;modsecurity&#x2F;crs-setup.conf\nInclude &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;modsecurity&#x2F;rules&#x2F;*.conf</code></pre></li>\n<li>重新加载Nginx<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -s reload</code></pre></li>\n<li>模拟攻击测试 <code>http://nginx.test/?param=%22%3E%3Cscript%3Ealert(1);%3C/script%3E</code><br><img src=\"http://img.moses.wang/20220609172618.png\"></li>\n</ol>\n<h1 id=\"进阶\"><a href=\"#进阶\" class=\"headerlink\" title=\"进阶\"></a>进阶</h1><h2 id=\"Nginx基于IP的安全防护策略\"><a href=\"#Nginx基于IP的安全防护策略\" class=\"headerlink\" title=\"Nginx基于IP的安全防护策略\"></a>Nginx基于IP的安全防护策略</h2><p>由于虚拟机部署的Nginx，Nginx访问日志IP为虚拟机网关IP<code>172.16.244.1</code></p>\n<h3 id=\"Nginx获取真实源IP\"><a href=\"#Nginx获取真实源IP\" class=\"headerlink\" title=\"Nginx获取真实源IP\"></a>Nginx获取真实源IP</h3><p>todo</p>\n<h3 id=\"Nginx禁止国外IP测试\"><a href=\"#Nginx禁止国外IP测试\" class=\"headerlink\" title=\"Nginx禁止国外IP测试\"></a>Nginx禁止国外IP测试</h3><p>挂代理访问不经过互联网，日志只记录虚拟机网关IP。局域网访问不到虚拟机IP。<br><img src=\"http://img.moses.wang/20220609175952.png\"><br>TODO</p>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> 通过colab创建VPS部署Nginx ✅ 2022-06-10 💀行不通</li>\n</ul>\n<h4 id=\"SSH-VNC\"><a href=\"#SSH-VNC\" class=\"headerlink\" title=\"SSH VNC\"></a>SSH VNC</h4><p><a href=\"https://github.com/hackingguy/Bug-Hunting-Colab/issues/31\">Failed to download https://bin.equinox.io/c/VdrWdbjqyF/cloudflared-stable-linux-amd64.tgz · Issue #31 · hackingguy/Bug-Hunting-Colab · GitHub</a><br><img src=\"http://img.moses.wang/20220610164944.png\"></p>\n<h4 id=\"Chrome-Remote-Desktop\"><a href=\"#Chrome-Remote-Desktop\" class=\"headerlink\" title=\"Chrome Remote Desktop\"></a>Chrome Remote Desktop</h4><p><img src=\"http://img.moses.wang/20220610165436.png\"><br><a href=\"https://research.google.com/colaboratory/faq.html#limitations-and-restrictions\">Google Colab常见问题</a><br>Colab 中的资源将优先提供给交互式用例。我们禁止各种涉及批量计算、会对他人造成负面影响，或试图规避我们的政策的操作。Colab 运行时中不允许执行下列操作：</p>\n<ul>\n<li>文件托管、媒体传送或提供其他与 Colab 的交互式计算无关的网络服务</li>\n<li>下载种子文件或进行点对点文件共享</li>\n<li>使用远程桌面或 SSH</li>\n<li>连接到远程代理</li>\n<li>加密货币挖矿</li>\n<li>运行拒绝服务攻击</li>\n<li>破解密码</li>\n<li>利用多个帐号绕过访问权限或资源使用情况限制</li>\n<li>创建深度伪造内容<br><img src=\"http://img.moses.wang/20220610164717.png\"></li>\n</ul>\n<p><a href=\"https://www.youtube.com/watch?v=bJUr0SnBpEM\">YouTube参考视频</a></p>\n<h2 id=\"创建DEMO应用\"><a href=\"#创建DEMO应用\" class=\"headerlink\" title=\"创建DEMO应用\"></a>创建DEMO应用</h2><p>[[RASP-JRASP#0x06测试用例]]</p>\n","text":"产品信息简介 名称 开源协议 开发语言 开源时间 活跃度 代码质量 最新版本 厂商 ModSecurity BSD 3-Clause License Lua 2013-12-16（2.7.6） 5.4K⭐️ A 2022-05-31 （3.1.7） Trustwave ModSec...","link":"","photos":[],"count_time":{"symbolsCount":"8.7k","symbolsTime":"8 mins."},"categories":[{"name":"开源WAF产品选型","slug":"开源WAF产品选型","count":7,"path":"api/categories/开源WAF产品选型.json"}],"tags":[{"name":"Nginx","slug":"Nginx","count":7,"path":"api/tags/Nginx.json"},{"name":"开源WAF产品选型","slug":"开源WAF产品选型","count":7,"path":"api/tags/开源WAF产品选型.json"},{"name":"安全建设","slug":"安全建设","count":7,"path":"api/tags/安全建设.json"},{"name":"WAF","slug":"WAF","count":6,"path":"api/tags/WAF.json"},{"name":"ModSecurity","slug":"ModSecurity","count":1,"path":"api/tags/ModSecurity.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BA%A7%E5%93%81%E4%BF%A1%E6%81%AF%E7%AE%80%E4%BB%8B\"><span class=\"toc-text\">产品信息简介</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#ModSecurity%E4%BB%8B%E7%BB%8D\"><span class=\"toc-text\">ModSecurity介绍</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8A%9F%E8%83%BD\"><span class=\"toc-text\">功能</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#ModSecurity%E5%8A%9F%E8%83%BD\"><span class=\"toc-text\">ModSecurity功能</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%87%86%E5%A4%87%E7%8E%AF%E5%A2%83\"><span class=\"toc-text\">准备环境</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">安装</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%BE%9D%E8%B5%96\"><span class=\"toc-text\">操作系统依赖</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85ModSecurity\"><span class=\"toc-text\">安装ModSecurity</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85Nginx%E4%B8%8EModSecurity-nginx\"><span class=\"toc-text\">安装Nginx与ModSecurity-nginx</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E9%AA%8C%E8%AF%81\"><span class=\"toc-text\">验证</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">配置</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E8%BF%9B%E9%98%B6\"><span class=\"toc-text\">进阶</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Nginx%E5%9F%BA%E4%BA%8EIP%E7%9A%84%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4%E7%AD%96%E7%95%A5\"><span class=\"toc-text\">Nginx基于IP的安全防护策略</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Nginx%E8%8E%B7%E5%8F%96%E7%9C%9F%E5%AE%9E%E6%BA%90IP\"><span class=\"toc-text\">Nginx获取真实源IP</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Nginx%E7%A6%81%E6%AD%A2%E5%9B%BD%E5%A4%96IP%E6%B5%8B%E8%AF%95\"><span class=\"toc-text\">Nginx禁止国外IP测试</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#SSH-VNC\"><span class=\"toc-text\">SSH VNC</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Chrome-Remote-Desktop\"><span class=\"toc-text\">Chrome Remote Desktop</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BADEMO%E5%BA%94%E7%94%A8\"><span class=\"toc-text\">创建DEMO应用</span></a></li></ol></li></ol>","author":{"name":"Moses","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一位正在重塑知识的技术人","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"开源WAF调研之产品选型-Nginx临时应急工具","uid":"ca8ec5f39f069a5397c4e6f4f192ade4","slug":"Nginx-log-check检测工具","date":"2022-06-15T14:30:16.000Z","updated":"2022-10-26T10:01:41.029Z","comments":true,"path":"api/articles/Nginx-log-check检测工具.json","keywords":null,"cover":"https://gtwallpaper.org/sites/default/files/wallpaper/159445/a-tunnel-8k-secret-passage-wallpapers-159445-3841-2646948.png","text":"工具介绍此脚本是参考nmgxy&#x2F;klionsec修改而来,重新添加了一些特征，只用来临时救急，还是推荐到ELK或者Splunk中分析🎩项目地址GitHub - al0ne&#x2F;nginx_log_check: Nginx日志安全分析脚本 功能 统计Top 20 地...","link":"","photos":[],"count_time":{"symbolsCount":"11k","symbolsTime":"10 mins."},"categories":[{"name":"开源WAF产品选型","slug":"开源WAF产品选型","count":7,"path":"api/categories/开源WAF产品选型.json"}],"tags":[{"name":"应急响应","slug":"应急响应","count":1,"path":"api/tags/应急响应.json"},{"name":"Nginx","slug":"Nginx","count":7,"path":"api/tags/Nginx.json"},{"name":"开源WAF产品选型","slug":"开源WAF产品选型","count":7,"path":"api/tags/开源WAF产品选型.json"},{"name":"日志分析","slug":"日志分析","count":1,"path":"api/tags/日志分析.json"},{"name":"安全建设","slug":"安全建设","count":7,"path":"api/tags/安全建设.json"}],"author":{"name":"Moses","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一位正在重塑知识的技术人","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"开源WAF调研之产品选型-Janusec","uid":"46d38e362d8b157bea9e251631b6d0f7","slug":"开源WAF选型-Janusec","date":"2022-06-08T05:58:01.418Z","updated":"2022-10-26T10:09:28.083Z","comments":true,"path":"api/articles/开源WAF选型-Janusec.json","keywords":null,"cover":"https://gtwallpaper.org/sites/default/files/wallpaper/159446/abrams-falls-wallpapers-159446-1807-7416337.png","text":"产品信息简介 名称 开源协议 开发语言 开源时间 活跃度 代码质量 最新版本 厂商 Janusec GNU AGPLv3 Go 2021-04-5（1.0.0） 923⭐️ 2022-04-03 （1.2.9） 个人开发者 产品描述Janusec应用网关，一种适用于各种场景（公有云...","link":"","photos":[],"count_time":{"symbolsCount":"5.8k","symbolsTime":"5 mins."},"categories":[{"name":"开源WAF产品选型","slug":"开源WAF产品选型","count":7,"path":"api/categories/开源WAF产品选型.json"}],"tags":[{"name":"Nginx","slug":"Nginx","count":7,"path":"api/tags/Nginx.json"},{"name":"开源WAF产品选型","slug":"开源WAF产品选型","count":7,"path":"api/tags/开源WAF产品选型.json"},{"name":"安全建设","slug":"安全建设","count":7,"path":"api/tags/安全建设.json"},{"name":"WAF","slug":"WAF","count":6,"path":"api/tags/WAF.json"},{"name":"Kong网关","slug":"Kong网关","count":1,"path":"api/tags/Kong网关.json"}],"author":{"name":"Moses","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一位正在重塑知识的技术人","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}