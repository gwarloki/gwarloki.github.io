{"title":"开源漏洞库工具-OpenCVE","uid":"c1f27b84e7a962a64fb70a195391b7ba","slug":"搭建漏洞库-OpenCVE","date":"2022-04-08T07:56:44.000Z","updated":"2022-10-26T07:53:48.607Z","comments":true,"path":"api/articles/搭建漏洞库-OpenCVE.json","keywords":null,"cover":"https://images.unsplash.com/photo-1571361656693-d7602246ce3c?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=628&ixid=MnwxfDB8MXxhbGx8fHx8fHx8fHwxNjE5ODc0NTE5&ixlib=rb-1.2.1&q=80&utm_campaign=api-credit&utm_medium=referral&utm_source=unsplash_source&w=1200","content":"<h1 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h1><p><strong>OpenCVE</strong>是一个平台，用于本地导入CVE列表并对其进行搜索（按供应商、产品、CVSS、CWE…）。</p>\n<ul>\n<li>项目地址<a href=\"https://github.com/opencve/opencve\">OpenCVE</a></li>\n<li>文档<a href=\"https://docs.opencve.io/\">OpenCVE Documentation</a></li>\n</ul>\n<h1 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h1><p><img src=\"http://img.moses.wang/20220619132900.png\"></p>\n<h1 id=\"数据源\"><a href=\"#数据源\" class=\"headerlink\" title=\"数据源\"></a>数据源</h1><ul>\n<li>CPE: <a href=\"https://nvd.nist.gov/feeds/xml/cpe/dictionary/official-cpe-dictionary_v2.3.xml.gz\">https://nvd.nist.gov/feeds/xml/cpe/dictionary/official-cpe-dictionary_v2.3.xml.gz</a></li>\n<li>CWE: <a href=\"https://cwe.mitre.org/data/xml/cwec_latest.xml.zip\">https://cwe.mitre.org/data/xml/cwec_latest.xml.zip</a></li>\n<li>CVE:<ul>\n<li><a href=\"https://nvd.nist.gov/feeds/json/cve/1.1/nvdcve-1.1-2021.json.gz\">https://nvd.nist.gov/feeds/json/cve/1.1/nvdcve-1.1-2021.json.gz</a></li>\n<li><a href=\"https://nvd.nist.gov/feeds/json/cve/1.1/nvdcve-1.1-2020.json.gz\">https://nvd.nist.gov/feeds/json/cve/1.1/nvdcve-1.1-2020.json.gz</a></li>\n<li><a href=\"https://nvd.nist.gov/feeds/json/cve/1.1/nvdcve-1.1-2019.json.gz\">https://nvd.nist.gov/feeds/json/cve/1.1/nvdcve-1.1-2019.json.gz</a></li>\n<li>[…]</li>\n<li><a href=\"https://nvd.nist.gov/feeds/json/cve/1.1/nvdcve-1.1-2002.json.gz\">https://nvd.nist.gov/feeds/json/cve/1.1/nvdcve-1.1-2002.json.gz</a><br><img src=\"http://img.moses.wang/20220619134251.png\"></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"API和数据源类型\"><a href=\"#API和数据源类型\" class=\"headerlink\" title=\"API和数据源类型\"></a>API和数据源类型</h2><table>\n<thead>\n<tr>\n<th>类型</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>CVE和CPE API</td>\n<td>传统漏洞数据提要文件的替代品。与JSON漏洞提要和CPE匹配提要相比，API要灵活得多，在单个界面中提供了更丰富的数据集。</td>\n</tr>\n<tr>\n<td>JSON脆弱性信息</td>\n<td>文件中的每个漏洞都包括来自CVE®词典提要的描述和相关参考链接，以及CVSS基本分数、易受攻击的产品配置和弱点分类。</td>\n</tr>\n<tr>\n<td>CPE比赛Feed</td>\n<td>根据官方CPE词典中的CPE匹配提供产品&#x2F;平台适用性声明到CPE URI匹配的提要。</td>\n</tr>\n<tr>\n<td>RSS漏洞Feed</td>\n<td>八天的安全相关软件缺陷窗口。</td>\n</tr>\n<tr>\n<td>漏洞翻译Feed</td>\n<td>漏洞提要的翻译。</td>\n</tr>\n<tr>\n<td>漏洞供应商评论</td>\n<td>供应商就影响产品内部的特定缺陷提供的评论。</td>\n</tr>\n<tr>\n<td>CPE词典</td>\n<td>包含产品列表的词典。</td>\n</tr>\n<tr>\n<td>通用配置枚举（CCE）参考数据</td>\n<td>常见配置项的参考数据。</td>\n</tr>\n</tbody></table>\n<h1 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h1><h2 id=\"手动安装\"><a href=\"#手动安装\" class=\"headerlink\" title=\"手动安装\"></a>手动安装</h2><p><a href=\"https://docs.opencve.io/installation/manual/\">Manual - OpenCVE Documentation</a></p>\n<h2 id=\"Docker-Installation\"><a href=\"#Docker-Installation\" class=\"headerlink\" title=\"Docker Installation\"></a>Docker Installation</h2><p>The Docker installation is the method to choose if you want to quickly deploy OpenCVE without managing the dependencies (like PostgreSQL, Redis or Celery).</p>\n<h3 id=\"Requirements\"><a href=\"#Requirements\" class=\"headerlink\" title=\"Requirements\"></a>Requirements</h3><p>The current documentation has been tested on <strong>Debian 10</strong> and <strong>Ubuntu LTS 20.04</strong> with the following requirements :</p>\n<ul>\n<li>Docker-compose 1.21.0+</li>\n<li>Docker 20.10.1+</li>\n<li>5 GB RAM</li>\n</ul>\n<h3 id=\"Configuration\"><a href=\"#Configuration\" class=\"headerlink\" title=\"Configuration\"></a>Configuration</h3><p>Get the OpenCVE docker repository:</p>\n<p><code>$ git clone https://github.com/opencve/opencve-docker.git</code> </p>\n<p>Prepare and copy the configuration file from the conf directory:</p>\n<p><code>$ cd opencve-docker &amp;&amp; cp ./conf/opencve.cfg.example ./conf/opencve.cfg</code> </p>\n<p>Update the following keys in the <code>opencve.cfg</code> file:</p>\n<ul>\n<li>server_name (use the same port if you changed it in the .env file)</li>\n<li>secret_key (see the Flask <a href=\"https://flask.palletsprojects.com/en/1.1.x/config/#SECRET_KEY\">recommandations</a>)</li>\n<li>smtp_server</li>\n<li>smtp_user &amp; smtp_password if any or leave empty</li>\n</ul>\n<p><strong>💡Tip</strong></p>\n<p>If you want to change the default postgresql password (strongly advised), you can add it in the <code>.env</code> file before the docker-compose build:</p>\n<p><code>POSTGRES_PASSWORD=MyStrongPassword42</code> </p>\n<h3 id=\"构建镜像文件\"><a href=\"#构建镜像文件\" class=\"headerlink\" title=\"构建镜像文件\"></a>构建镜像文件</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">$ docker-compose build&#96; </code></pre>\n<h3 id=\"启动容器\"><a href=\"#启动容器\" class=\"headerlink\" title=\"启动容器\"></a>启动容器</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">$ docker-compose up -d postgres redis webserver celery_worker</code></pre>\n<h3 id=\"初始化数据库\"><a href=\"#初始化数据库\" class=\"headerlink\" title=\"初始化数据库\"></a>初始化数据库</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">$ docker exec -it webserver opencve upgrade-db</code></pre>\n<h3 id=\"导入数据\"><a href=\"#导入数据\" class=\"headerlink\" title=\"导入数据\"></a>导入数据</h3><p>导入数据命令</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">$ docker exec -it webserver opencve import-data&#96; </code></pre>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>Warning<br>The NVD data are downloaded, extracted and then parsed <strong>in-memory</strong> before being inserted in the database. For that the <code>import-data</code> command needs <strong>5GB</strong> at least to correctly do its job. Afterwards, the worker use very small memory as only the diff is used with the NVD.<br>If you launch <code>opencve import-data</code> without this memory space the command will be killed (OOM) by your operating system and your data will be incompletes.<br>We wrote a <a href=\"https://docs.opencve.io/faq/#how-to-use-the-disk-space-for-the-import-data-command\">documentation</a> to handle this problem using a SWAP file.</p></blockquote>\n<p><strong>导入数据速度比较慢，从2002-2022年，CWE文件比较大,第一次导入经常报错</strong><br><img src=\"http://img.moses.wang/20220620144608.png\"><br>📢导入失败，终止原因可能是网络问题（之前分别终止在2007年数据、2010年数据），当然也不排除docker内存问题及存储空间问题<br><img src=\"http://img.moses.wang/20220621095113.png\"><br>📢导入失败后，初始化数据库报错</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">opencve upgrade-db\nINFO  [alembic.runtime.migration] Context impl PostgresqlImpl.\nINFO  [alembic.runtime.migration] Will assume transactional DDL.</code></pre>\n<p><img src=\"http://img.moses.wang/20220621133920.png\"><br><strong>对策1：</strong> 使用<code>docker-compose</code>命令停止并删除资源后，重新部署。</p>\n<pre class=\"line-numbers language-makedown\" data-language=\"makedown\"><code class=\"language-makedown\">docker-compose\nOptions:  \n--rmi type 删除镜像,可选参数all(删除所有镜像),local(只删除没有tag的镜像)  \n-v, --volumes 删除命名volumes和挂载到容器中的匿名volumes  \n--remove-orphans 删除Compose文件中未定义的服务的容器  \n-t, --timeout TIMEOUT Specify a shutdown timeout in seconds. (default: 10)</code></pre>\n<p><strong>对策2：</strong> 手动导入数据库或者使用opencve脚本下载导入到PostgreSQL</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 登录数据库\npsql postgresql:&#x2F;&#x2F;opencve:opencve@postgres:5432&#x2F;opencve\n# 查看所有数据库\nopencve-# \\l\n                               List of databases\n   Name    |  Owner  | Encoding |  Collate   |   Ctype    |  Access privileges\n-----------+---------+----------+------------+------------+---------------------\n opencve   | opencve | UTF8     | en_US.utf8 | en_US.utf8 |\n postgres  | opencve | UTF8     | en_US.utf8 | en_US.utf8 |\n template0 | opencve | UTF8     | en_US.utf8 | en_US.utf8 | &#x3D;c&#x2F;opencve         +\n           |         |          |            |            | opencve&#x3D;CTc&#x2F;opencve\n template1 | opencve | UTF8     | en_US.utf8 | en_US.utf8 | &#x3D;c&#x2F;opencve         +\n           |         |          |            |            | opencve&#x3D;CTc&#x2F;opencve\n(4 rows)\n# 查看数据库中的表\nopencve-# \\d\n             List of relations\n Schema |      Name       | Type  |  Owner\n--------+-----------------+-------+---------\n public | alembic_version | table | opencve\n public | alerts          | table | opencve\n public | alerts_events   | table | opencve\n public | changes         | table | opencve\n public | cves            | table | opencve\n public | cves_tags       | table | opencve\n public | cwes            | table | opencve\n public | events          | table | opencve\n public | metas           | table | opencve\n public | products        | table | opencve\n public | reports         | table | opencve\n public | tasks           | table | opencve\n public | users           | table | opencve\n public | users_products  | table | opencve\n public | users_tags      | table | opencve\n public | users_vendors   | table | opencve\n public | vendors         | table | opencve\n(17 rows)</code></pre>\n<h3 id=\"Create-an-admin\"><a href=\"#Create-an-admin\" class=\"headerlink\" title=\"Create an admin\"></a>Create an admin</h3><pre class=\"line-numbers language-h\" data-language=\"h\"><code class=\"language-h\">docker exec -it webserver opencve create-user admin admin@happycfc.com --admin\nPassword:\nRepeat for confirmation:\n[*] User john created.&#96; </code></pre>\n\n\n<h3 id=\"Start-the-beat\"><a href=\"#Start-the-beat\" class=\"headerlink\" title=\"Start the beat\"></a>Start the beat</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">docker-compose up -d celery_beat</code></pre>\n\n<h1 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h1><p>使用其REST API与OpenCVE交互。详见API文档<a href=\"https://docs.opencve.io/api/\">Introduction - OpenCVE Documentation</a><br>请求示例：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">GET &#x2F;api&#x2F;cve HTTP&#x2F;1.1 Host: example.com Accept: application&#x2F;json</code></pre>\n<p><img src=\"http://img.moses.wang/20220621101422.png\"></p>\n","text":"简介OpenCVE是一个平台，用于本地导入CVE列表并对其进行搜索（按供应商、产品、CVSS、CWE…）。 项目地址OpenCVE 文档OpenCVE Documentation 原理 数据源 CPE: https://nvd.nist.gov/feeds/xml/cpe/dic...","link":"","photos":[],"count_time":{"symbolsCount":"5.3k","symbolsTime":"5 mins."},"categories":[{"name":"软件供应链安全","slug":"软件供应链安全","count":26,"path":"api/categories/软件供应链安全.json"}],"tags":[{"name":"开源漏洞库","slug":"开源漏洞库","count":2,"path":"api/tags/开源漏洞库.json"},{"name":"部署手册","slug":"部署手册","count":3,"path":"api/tags/部署手册.json"},{"name":"OpenCVE","slug":"OpenCVE","count":1,"path":"api/tags/OpenCVE.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%AE%80%E4%BB%8B\"><span class=\"toc-text\">简介</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">原理</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E6%BA%90\"><span class=\"toc-text\">数据源</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#API%E5%92%8C%E6%95%B0%E6%8D%AE%E6%BA%90%E7%B1%BB%E5%9E%8B\"><span class=\"toc-text\">API和数据源类型</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">安装</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">手动安装</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Docker-Installation\"><span class=\"toc-text\">Docker Installation</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Requirements\"><span class=\"toc-text\">Requirements</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Configuration\"><span class=\"toc-text\">Configuration</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">构建镜像文件</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8\"><span class=\"toc-text\">启动容器</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">初始化数据库</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">导入数据</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Create-an-admin\"><span class=\"toc-text\">Create an admin</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Start-the-beat\"><span class=\"toc-text\">Start the beat</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#API\"><span class=\"toc-text\">API</span></a></li></ol>","author":{"name":"Moses","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一位正在重塑知识的技术人","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"容器安全-针对容器的渗透测试方法","uid":"187ba77175374873452e35cc1b1a9ffe","slug":"针对容器的渗透测试方法","date":"2022-04-11T03:36:00.000Z","updated":"2022-10-27T02:29:32.680Z","comments":true,"path":"api/articles/针对容器的渗透测试方法.json","keywords":null,"cover":"https://gtwallpaper.org/sites/default/files/wallpaper/159415/4k-beautiful-sunrise-reflection-wallpapers-159415-2155406-2770784.png","text":"攻击者模型攻击者模型容器逃逸和针对Docker守护进程的攻击，分别对应位于容器内部的攻击者和位于运行了Docker守护进程的宿主机上的攻击者。 其中，容器逃逸包括容器内进程影响到宿主机或其他容器两种情况，示意图如下： 针对Docker守护进程的攻击则指宿主机上低权限攻击者借助Do...","link":"","photos":[],"count_time":{"symbolsCount":"5.2k","symbolsTime":"5 mins."},"categories":[{"name":"Cloud-Native-Security","slug":"Cloud-Native-Security","count":12,"path":"api/categories/Cloud-Native-Security.json"}],"tags":[{"name":"容器安全","slug":"容器安全","count":3,"path":"api/tags/容器安全.json"},{"name":"优秀文章收藏","slug":"优秀文章收藏","count":5,"path":"api/tags/优秀文章收藏.json"},{"name":"渗透测试","slug":"渗透测试","count":1,"path":"api/tags/渗透测试.json"}],"author":{"name":"Moses","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一位正在重塑知识的技术人","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"容器安全平台-NeuVector","uid":"56dbee3ed1ebfa2e56e8dd9905790f13","slug":"容器安全平台-NeuVector","date":"2022-03-04T09:47:49.000Z","updated":"2022-10-27T02:15:32.168Z","comments":true,"path":"api/articles/容器安全平台-NeuVector.json","keywords":null,"cover":"https://gtwallpaper.org/sites/default/files/wallpaper/159445/a-tunnel-8k-secret-passage-wallpapers-159445-3997-159990.png","text":"开源云原生产品现状 项目 厂商 链接 Star 类型 开源时间 clair Quay https://github.com/quay/clair 8.4k 镜像扫描 2015-11-13 trivy Aqua https://github.com/aquasecurity/tri...","link":"","photos":[],"count_time":{"symbolsCount":"12k","symbolsTime":"11 mins."},"categories":[{"name":"Cloud-Native-Security","slug":"Cloud-Native-Security","count":12,"path":"api/categories/Cloud-Native-Security.json"}],"tags":[{"name":"云原生安全","slug":"云原生安全","count":6,"path":"api/tags/云原生安全.json"},{"name":"NeuVector","slug":"NeuVector","count":1,"path":"api/tags/NeuVector.json"},{"name":"容器安全平台","slug":"容器安全平台","count":5,"path":"api/tags/容器安全平台.json"},{"name":"suse","slug":"suse","count":1,"path":"api/tags/suse.json"},{"name":"产品选型","slug":"产品选型","count":6,"path":"api/tags/产品选型.json"}],"author":{"name":"Moses","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一位正在重塑知识的技术人","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}