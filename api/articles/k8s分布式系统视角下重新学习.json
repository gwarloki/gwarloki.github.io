{"title":"k8s分布式系统视角下重新学习","uid":"ce038301b34a6d4d69c83e210fe584c3","slug":"k8s分布式系统视角下重新学习","date":"2022-10-25T01:27:40.674Z","updated":"2022-10-26T09:22:49.037Z","comments":true,"path":"api/articles/k8s分布式系统视角下重新学习.json","keywords":null,"cover":"https://gtwallpaper.org/sites/default/files/wallpaper/159414/4k-backlit-dawn-wallpapers-159414-29514-9093492.png","content":"<h1 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h1><p><a href=\"https://kubernetes.io/zh/docs/concepts/overview/\">官网地址</a><br> Kubernetes是什么?<br><a href=\"https://kubernetes.io/zh/docs/concepts/overview/what-is-kubernetes/\">官网地址</a></p>\n<h2 id=\"时光回溯-History-of-cloud\"><a href=\"#时光回溯-History-of-cloud\" class=\"headerlink\" title=\"时光回溯[[History of cloud]]\"></a>时光回溯[[History of cloud]]</h2><p><img src=\"http://img.moses.wang/20220615170546.png\"></p>\n<h2 id=\"传统部署时代\"><a href=\"#传统部署时代\" class=\"headerlink\" title=\"传统部署时代\"></a>传统部署时代</h2><p>例如：安装Oracle</p>\n<ul>\n<li>针对操作系统准备安装包(下载或者U盘拷贝)</li>\n<li>安装Oracle需要的基础类库</li>\n<li>配置操作系统的相应配置</li>\n<li>执行安装检查，安装命令</li>\n<li>安装失败之后，要完全卸载</li>\n</ul>\n<h2 id=\"虚拟化部署时代\"><a href=\"#虚拟化部署时代\" class=\"headerlink\" title=\"虚拟化部署时代\"></a>虚拟化部署时代</h2><ul>\n<li>只是做了物理资源隔离，安装一个Oracle仍旧是个复杂的过程。</li>\n</ul>\n<h2 id=\"容器部署时代\"><a href=\"#容器部署时代\" class=\"headerlink\" title=\"容器部署时代\"></a>容器部署时代</h2><ul>\n<li>敏捷应用程序的创建和部署</li>\n<li>关注点在如何构建应用程序的镜像以及启动镜像时的参数配置</li>\n<li>持续开发、集成和部署</li>\n<li>关注开发和运维的分离</li>\n<li>可观察性<br> 跨开发、测试和生产环境的一致性</li>\n<li>可以使用同样的构建产物，在不同的环境上运行，只是启动参数的差异。</li>\n<li>跨云和操作系统发型版本的可移植性<ul>\n<li>容器运行环境解决了不同的云和操作系统之间的差异</li>\n</ul>\n</li>\n<li>以应用程序为中心的管理</li>\n<li>松耦合、分布式、弹性、解放的微服务<ul>\n<li>应用跟硬件，操作系统，网络都没有关系</li>\n<li>弹性：副本数可伸缩</li>\n</ul>\n</li>\n<li>资源隔离<ul>\n<li>每个应用使用的资管互不影响</li>\n</ul>\n</li>\n<li>资源利用<ul>\n<li>一个应用的资源利用不是固定的，例如启动一个应用的最低配置和最大需要的配置等。</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"为什么需要Kubernetes-它能做什么\"><a href=\"#为什么需要Kubernetes-它能做什么\" class=\"headerlink\" title=\"为什么需要Kubernetes,它能做什么?\"></a>为什么需要Kubernetes,它能做什么?</h1><ul>\n<li>服务发现和负载均衡<ul>\n<li>微服务的两大基石<ul>\n<li>RPC</li>\n<li>消息</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>存储编排</li>\n<li>自动部署和回滚</li>\n<li>自动完成装箱计算<ul>\n<li>背包问题</li>\n</ul>\n</li>\n<li>自我修复<ul>\n<li>传统部署方案需要写定时任务来做应用健康检查和自我修复</li>\n</ul>\n</li>\n<li>秘钥与配置管理</li>\n</ul>\n<h1 id=\"Kubernetes不是什么\"><a href=\"#Kubernetes不是什么\" class=\"headerlink\" title=\"Kubernetes不是什么\"></a>Kubernetes不是什么</h1><ul>\n<li>不限制支持的应用类型。</li>\n<li>不部署源代码,也不构建你的应用程序。</li>\n</ul>\n<h1 id=\"Kubernetes组件\"><a href=\"#Kubernetes组件\" class=\"headerlink\" title=\"Kubernetes组件\"></a>Kubernetes组件</h1><p><a href=\"https://kubernetes.io/zh/docs/concepts/overview/components/\">官网地址</a><br><img src=\"http://img.moses.wang/20220615171356.png\"></p>\n<h2 id=\"控制平面组件-Control-Plane-Components\"><a href=\"#控制平面组件-Control-Plane-Components\" class=\"headerlink\" title=\"控制平面组件(Control Plane Components)\"></a>控制平面组件(Control Plane Components)</h2><ul>\n<li>kube-apiserver<ul>\n<li>该组件公开了 Kubernetes API</li>\n<li>支持水平扩展<ul>\n<li>x轴扩展 增加副本数 ✔️</li>\n<li>y轴扩展 功能、业务拆分成不同的微服务</li>\n<li>z轴扩展 数据分片，租户隔离</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"etcd\"><a href=\"#etcd\" class=\"headerlink\" title=\"etcd\"></a>etcd</h2><h3 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h3><p><a href=\"https://etcd.io/\">etcd</a> 是兼具一致性和高可用性的键值数据库</p>\n<h3 id=\"特点\"><a href=\"#特点\" class=\"headerlink\" title=\"特点\"></a>特点</h3><p> [[CAP]]的抉择，etcd是分布式系统，必然无法避开选择P，在CA中选择C,即CP。</p>\n<ul>\n<li>一致性 ✔️</li>\n<li>高可用 ✔️</li>\n<li>分区容错 X</li>\n</ul>\n<h3 id=\"对比VSConsul-Zookeeper\"><a href=\"#对比VSConsul-Zookeeper\" class=\"headerlink\" title=\"对比VSConsul Zookeeper\"></a>对比VSConsul Zookeeper</h3><p> <a href=\"https://etcd.io/docs/v3.5/learning/why/\">etcd versus other key-value stores | etcd</a><br><img src=\"http://img.moses.wang/20220615174013.png\"></p>\n<h3 id=\"两大使用场景\"><a href=\"#两大使用场景\" class=\"headerlink\" title=\"两大使用场景\"></a>两大使用场景</h3><ul>\n<li>Using etcd for metadata</li>\n<li>Using etcd for distributed coordination</li>\n</ul>\n<h2 id=\"kube-scheduler\"><a href=\"#kube-scheduler\" class=\"headerlink\" title=\"kube-scheduler\"></a>kube-scheduler</h2><p>负责监视新创建的、未指定运行节点的 Pods，选择节点让 Pod 在上面运行。</p>\n<h3 id=\"调度决策考虑的因素包括\"><a href=\"#调度决策考虑的因素包括\" class=\"headerlink\" title=\"调度决策考虑的因素包括\"></a>调度决策考虑的因素包括</h3><ul>\n<li>单个 Pod 和 Pod 集合的资源需求</li>\n<li>硬件&#x2F;软件&#x2F;策略约束</li>\n<li>亲和性和反亲和性规范</li>\n<li>数据位置</li>\n<li>工作负载间的干扰和最后时限</li>\n</ul>\n<h2 id=\"kube-controller-manager\"><a href=\"#kube-controller-manager\" class=\"headerlink\" title=\"kube-controller-manager\"></a>kube-controller-manager</h2><ul>\n<li>节点控制器（Node Controller）: 负责在节点出现故障时进行通知和响应</li>\n<li>任务控制器（Job controller）: 监测代表一次性任务的 Job 对象，然后创建 Pods 来运行这些任务直至完成</li>\n<li>端点控制器（Endpoints Controller）: 填充端点(Endpoints)对象(即加入 Service 与 Pod)</li>\n<li>服务帐户和令牌控制器（Service Account &amp; Token Controllers）: 为新的命名空间创建默认帐户和 API 访问令牌</li>\n</ul>\n<h2 id=\"cloud-controller-manager\"><a href=\"#cloud-controller-manager\" class=\"headerlink\" title=\"cloud-controller-manager\"></a>cloud-controller-manager</h2><ul>\n<li>节点控制器（Node Controller）: 用于在节点终止响应后检查云提供商以确定节点是否已被删除</li>\n<li>路由控制器（Route Controller）: 用于在底层云基础架构中设置路由</li>\n<li>服务控制器（Service Controller）: 用于创建、更新和删除云提供商负载均衡器</li>\n</ul>\n<h2 id=\"Node组件\"><a href=\"#Node组件\" class=\"headerlink\" title=\"Node组件\"></a>Node组件</h2><h3 id=\"kubelet\"><a href=\"#kubelet\" class=\"headerlink\" title=\"kubelet\"></a>kubelet</h3><ul>\n<li>一个在集群中每个节点上运行的代理。</li>\n<li>它保证容器（containers）都 运行在 Pod 中。</li>\n<li>kubelet 接收一组通过各类机制提供给它的 PodSpecs，确保这些 PodSpecs 中描述的容器处于运行状态且健康。</li>\n<li>kubelet 不会管理不是由 Kubernetes 创建的容器。</li>\n</ul>\n<h3 id=\"kube-proxy\"><a href=\"#kube-proxy\" class=\"headerlink\" title=\"kube-proxy\"></a>kube-proxy</h3><ul>\n<li>是集群中每个节点上运行的网络代理</li>\n<li>维护节点上的网络规则</li>\n<li>如果操作系统提供了数据包过滤层并可用的话，kube-proxy 会通过它(例如[[iptables]])来实现网络规则。否则， kube-proxy 仅转发流量本身。</li>\n<li>容器运行时(Container Runtime)</li>\n<li>[[CRI&amp;OCI]]</li>\n</ul>\n<h2 id=\"插件-Addon\"><a href=\"#插件-Addon\" class=\"headerlink\" title=\"插件(Addon)\"></a>插件(Addon)</h2><h3 id=\"DNS\"><a href=\"#DNS\" class=\"headerlink\" title=\"DNS\"></a>DNS</h3><ul>\n<li>集群 DNS 是一个 DNS 服务器，和环境中的其他 DNS 服务器一起工作，它为 Kubernetes 服务提供 DNS 记录。</li>\n<li>Kubernetes 启动的容器自动将此 DNS 服务器包含在其 DNS 搜索列表中。</li>\n<li>Web界面(仪表盘)</li>\n<li>容器资源监控</li>\n<li>集群层面日志</li>\n</ul>\n<h2 id=\"KubernetesAPI\"><a href=\"#KubernetesAPI\" class=\"headerlink\" title=\"KubernetesAPI\"></a>KubernetesAPI</h2><p> <a href=\"https://kubernetes.io/zh/docs/concepts/overview/kubernetes-api/\">官网地址</a></p>\n<ul>\n<li>OpenAPI规范</li>\n<li>OpenAPI V2</li>\n<li>OpenAPI V3</li>\n</ul>\n<h2 id=\"使用Kubernetes对象\"><a href=\"#使用Kubernetes对象\" class=\"headerlink\" title=\"使用Kubernetes对象\"></a>使用Kubernetes对象</h2><p> <a href=\"(https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/)\">官网地址</a><br>理解Kubernetes对象<br> <a href=\"https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/kubernetes-objects/\">官网地址</a></p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><ul>\n<li>Kubernetes 对象是持久化的实体</li>\n<li>Kubernetes 使用这些实体去表示整个集群的状态</li>\n<li>达成的效果<ul>\n<li>哪些容器化应用在运行（以及在哪些节点上）</li>\n<li>可以被应用使用的资源</li>\n<li>关于应用运行时表现的策略，比如重启策略、升级策略，以及容错策略</li>\n</ul>\n</li>\n<li>Kubernetes 对象是 “目标性记录” —— 一旦创建对象，Kubernetes 系统将持续工作以确保对象存在。 通过创建对象，本质上是在告知 Kubernetes 系统，所需要的集群工作负载看起来是什么样子的， 这就是 Kubernetes 集群的 期望状态（Desired State）。<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">select amount from wallet where user_id &#x3D; 123456;\n100\t\t\t\t\t\t  \nupdate wallet set amount &#x3D; amount+10 where user_id &#x3D; 123456;\t\t\t\t\t\t \nor \t\t\t\t\t\t  \nupdate wallet set amount &#x3D; 100+10 where user_id &#x3D; 123456; </code></pre>\n<strong>所有对Kubernetes对象的操作，最终都是通过使用 Kubernetes API</strong></li>\n</ul>\n<h1 id=\"对象规约（Spec）与状态（Status）\"><a href=\"#对象规约（Spec）与状态（Status）\" class=\"headerlink\" title=\"对象规约（Spec）与状态（Status）\"></a>对象规约（Spec）与状态（Status）</h1><ul>\n<li>Spec： 对象期望状态（Desired State）</li>\n<li>Status：对象当前状态（Current State）<ul>\n<li>描述 Kubernetes 对象</li>\n<li>多数情况下是使用yaml文件描述。</li>\n<li>必需字段</li>\n</ul>\n</li>\n<li>apiVersion - 创建该对象所使用的 Kubernetes API 的版本<ul>\n<li>例如：apps&#x2F;v1</li>\n</ul>\n</li>\n<li>kind - 想要创建的对象的类别<ul>\n<li>例如：Pod，Deployment，Service</li>\n</ul>\n</li>\n<li>metadata - 帮助唯一性标识对象的一些数据，包括一个 name 字符串、UID 和可选的 namespac</li>\n<li>spec - 你所期望的该对象的状态，对象 spec 的精确格式对每个 Kubernetes 对象来说是不同的。</li>\n</ul>\n<h1 id=\"Kubernetes对象管理\"><a href=\"#Kubernetes对象管理\" class=\"headerlink\" title=\"Kubernetes对象管理\"></a>Kubernetes对象管理</h1><p> <a href=\"https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/object-management/\">官网地址</a></p>\n<h2 id=\"管理技巧\"><a href=\"#管理技巧\" class=\"headerlink\" title=\"管理技巧\"></a>管理技巧</h2><p><img src=\"http://img.moses.wang/20220615172346.png\"></p>\n<h2 id=\"指令式命令\"><a href=\"#指令式命令\" class=\"headerlink\" title=\"指令式命令\"></a>指令式命令</h2><p><a href=\"https://kubernetes.io/zh/docs/tasks/manage-kubernetes-objects/imperative-command/\">官方文档</a></p>\n<h3 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">kubectl create deployment nginx --image nginx</code></pre>\n<h3 id=\"权衡\"><a href=\"#权衡\" class=\"headerlink\" title=\"权衡\"></a>权衡</h3><ul>\n<li>与对象配置相比的有点：<ul>\n<li>命令简单，易学且易于记忆。</li>\n<li>命令仅需一步即可对集群进行更改。</li>\n<li>与对象配置相比的缺点：</li>\n<li>命令不便于与变更审查流程的集成。</li>\n<li>命令不提供与更改关联的审核跟踪。</li>\n<li>除了实时内容外，命令不提供记录原。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"指令式对象配置\"><a href=\"#指令式对象配置\" class=\"headerlink\" title=\"指令式对象配置\"></a>指令式对象配置</h2><p> <a href=\"https://kubernetes.io/zh/docs/tasks/manage-kubernetes-objects/imperative-config/\">官方文档</a></p>\n<h3 id=\"例子-1\"><a href=\"#例子-1\" class=\"headerlink\" title=\"例子\"></a>例子</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">kubectl create -f nginx.yaml\nkubectl delete -f nginx.yaml -f redis.yaml\nkubectl replace -f nginx.yaml</code></pre>\n<h3 id=\"权衡-1\"><a href=\"#权衡-1\" class=\"headerlink\" title=\"权衡\"></a>权衡</h3><h4 id=\"与执行令式命令相比优点\"><a href=\"#与执行令式命令相比优点\" class=\"headerlink\" title=\"与执行令式命令相比优点\"></a>与执行令式命令相比优点</h4><ul>\n<li>对象配置可以存储在源控制系统中，比如Git。</li>\n<li>对象配置可以与流程集成，例如在推送和审计之前检查更新。</li>\n<li>对象配置提供了用于创建新对象的模板。</li>\n</ul>\n<h4 id=\"与执行令式命令相比缺点：\"><a href=\"#与执行令式命令相比缺点：\" class=\"headerlink\" title=\"与执行令式命令相比缺点：\"></a>与执行令式命令相比缺点：</h4><ul>\n<li>对象配置需要对对象架构有基本的了解。(不算缺点)</li>\n<li>对象配置需要额外的步骤来编写yaml文件。</li>\n</ul>\n<h4 id=\"与声明式对象配置相比优点：\"><a href=\"#与声明式对象配置相比优点：\" class=\"headerlink\" title=\"与声明式对象配置相比优点：\"></a>与声明式对象配置相比优点：</h4><ul>\n<li>指令式对象配置行为更加简单易懂。</li>\n<li>从 Kubernetes 1.5 版本开始，指令对象配置更加成熟。</li>\n</ul>\n<h4 id=\"与声明式对象配置相比缺点：\"><a href=\"#与声明式对象配置相比缺点：\" class=\"headerlink\" title=\"与声明式对象配置相比缺点：\"></a>与声明式对象配置相比缺点：</h4><ul>\n<li>指令式对象配置更适合文件，而非目录。</li>\n<li>对活动对象的更新，必须反应在配置文件中，否则会在下一次替换时丢失。(比如副本数，文件中为3，手动调整为6后，重新发布，又变回了3)</li>\n</ul>\n<h2 id=\"声明式对象配置\"><a href=\"#声明式对象配置\" class=\"headerlink\" title=\"声明式对象配置\"></a>声明式对象配置</h2><p><a href=\"https://kubernetes.io/zh/docs/tasks/manage-kubernetes-objects/declarative-config/\">官方文档</a></p>\n<h3 id=\"例子-2\"><a href=\"#例子-2\" class=\"headerlink\" title=\"例子\"></a>例子</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">kubectl diff -f configs&#x2F;\nkubectl apply -f configs&#x2F;\nkubectl diff -R -f configs&#x2F;\nkubectl apply -R -f configs&#x2F;</code></pre>\n<h3 id=\"权衡-2\"><a href=\"#权衡-2\" class=\"headerlink\" title=\"权衡\"></a>权衡</h3><h4 id=\"与指令式对象配置相比优点：\"><a href=\"#与指令式对象配置相比优点：\" class=\"headerlink\" title=\"与指令式对象配置相比优点：\"></a>与指令式对象配置相比优点：</h4><ul>\n<li>对活动对象所做的更改即使未合并到配置文件中，也会被保留下来。</li>\n<li>声明性对象配置更好地支持对目录进行操作并自动检测每个文件的操作类型(创建，修补，删除)。</li>\n</ul>\n<h4 id=\"与指令式对象配置相比缺点：\"><a href=\"#与指令式对象配置相比缺点：\" class=\"headerlink\" title=\"与指令式对象配置相比缺点：\"></a>与指令式对象配置相比缺点：</h4><ul>\n<li>声明式对象配置难于调试并且出现异常时结果难以解释。</li>\n<li>使用diff产生的部分更新会创建复杂的合并和布丁操作。</li>\n</ul>\n<h1 id=\"分析工作场景，选择合适的方案\"><a href=\"#分析工作场景，选择合适的方案\" class=\"headerlink\" title=\"分析工作场景，选择合适的方案\"></a>分析工作场景，选择合适的方案</h1><h2 id=\"运维中要解决的问题\"><a href=\"#运维中要解决的问题\" class=\"headerlink\" title=\"运维中要解决的问题\"></a>运维中要解决的问题</h2><ul>\n<li>1.审计，谁在什么时间做了什么操作，达到了什么效果</li>\n<li>2.可重复执行，相同的操作重复执行，结果不变</li>\n<li>3.可回滚<ul>\n<li>便捷且安全的回滚方案，支持单个应用和多个相关应用的回滚。</li>\n<li>命令如何回滚，配置如何回滚？</li>\n</ul>\n</li>\n<li>4.版本控制，版本差异的比对</li>\n<li>5.CI&#x2F;CD</li>\n</ul>\n<h1 id=\"对象名称和IDs\"><a href=\"#对象名称和IDs\" class=\"headerlink\" title=\"对象名称和IDs\"></a>对象名称和IDs</h1><p><a href=\"https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/names/\">官网地址</a><br> 名称 集群中的每一个对象都有一个名称 来标识在同类资源中的唯一性。</p>\n<ul>\n<li>DNS子域名</li>\n<li>不能超过253个字符</li>\n<li>只能包含小写字母、数字，以及’-‘ 和 ‘.’</li>\n<li>须以字母数字开头</li>\n<li>须以字母数字结尾<ul>\n<li>RFC 1123</li>\n</ul>\n</li>\n<li>最多 63 个字符</li>\n<li>只能包含小写字母、数字，以及 ‘-‘</li>\n<li>须以字母数字开头</li>\n<li>须以字母数字结尾<ul>\n<li>RFC 1035<br>          - 路径分段名称</li>\n</ul>\n</li>\n<li>UIDs 每个 Kubernetes 对象也有一个UID 来标识在整个集群中的唯一性。</li>\n</ul>\n<h1 id=\"命名空间\"><a href=\"#命名空间\" class=\"headerlink\" title=\"命名空间\"></a>命名空间</h1><p><a href=\"https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/namespaces/\">官网地址</a></p>\n<h2 id=\"作用\"><a href=\"#作用\" class=\"headerlink\" title=\"作用\"></a>作用</h2><ul>\n<li>将同一集群中的资源划分为相互隔离的组。</li>\n</ul>\n<h2 id=\"限制\"><a href=\"#限制\" class=\"headerlink\" title=\"限制\"></a>限制</h2><ul>\n<li>同一命名空间内的资源名称要唯一，但命名空间时没有这个要求。</li>\n<li>作用于Demployment、Service等。</li>\n<li>对StorageClass、Node、PersistentVolume等不适应。</li>\n</ul>\n<h2 id=\"何时使用多个命名空间\"><a href=\"#何时使用多个命名空间\" class=\"headerlink\" title=\"何时使用多个命名空间\"></a>何时使用多个命名空间</h2><ul>\n<li>命名空间适用于存在很多跨多个团队或项目的用户的场景。</li>\n<li>命名空间不能相互嵌套，每个 Kubernetes 资源只能在一个名字空间中。</li>\n<li>命名空间是在多个用户之间划分集群资源的一种方法。<br> 不必使用多个名字空间来分隔仅仅轻微不同的资源，例如同一软件的不同版本： 应该使用标签 来区分同一名字空间中的不同资源。</li>\n</ul>\n<h2 id=\"使用命名空间\"><a href=\"#使用命名空间\" class=\"headerlink\" title=\"使用命名空间\"></a>使用命名空间</h2><p>查看命名空间</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">## 待执行的命令\nkubectl get namespace\n## 执行结果\n[root@k8s-master-22 ~]# kubectl get namespaces\nNAME              STATUS   AGE\ndefault           Active   13d\nistio-system      Active   13d\nkube-node-lease   Active   13d\nkube-public       Active   13d\nkube-system       Active   13d\n[root@k8s-master-22 ~]#</code></pre>\n<h2 id=\"Kubernetes会创建四个初始的命名空间\"><a href=\"#Kubernetes会创建四个初始的命名空间\" class=\"headerlink\" title=\"Kubernetes会创建四个初始的命名空间\"></a>Kubernetes会创建四个初始的命名空间</h2><ul>\n<li>default 没有指明使用其它名字空间的对象所使用的默认名字空间</li>\n<li>kube-system Kubernetes 系统创建对象所使用的名字空间</li>\n<li>kube-public 这个命名空间是自动创建的，所有用户都可以读取它。</li>\n<li>kube-node-lease 此命名空间用于与各个节点相关的租约对象。允许kubelet发送心跳到api-server</li>\n</ul>\n<h2 id=\"操作指定命名空间\"><a href=\"#操作指定命名空间\" class=\"headerlink\" title=\"操作指定命名空间\"></a>操作指定命名空间</h2><p>例如</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">kubectl run nginx --image&#x3D;nginx --namespace&#x3D;&lt;insert-namespace-name-here&gt;\nkubectl get pods --namespace&#x3D;&lt;insert-namespace-name-here&gt;\n\n## 实际执行结果\nkubectl get pod --namespace&#x3D;kube-system\n[root@k8s-master-22 ~]# kubectl get pod --namespace&#x3D;kube-system\nNAME                                       READY   STATUS    RESTARTS        AGE\ncalico-kube-controllers-6fd7b9848d-4zlm5   1&#x2F;1     Running   3 (4h40m ago)   13d\ncalico-node-5c694                          1&#x2F;1     Running   3 (4h40m ago)   13d\ncalico-node-qgtxj                          1&#x2F;1     Running   3 (4h40m ago)   13d\ncoredns-7f6cbbb7b8-r4px6                   1&#x2F;1     Running   3 (4h39m ago)   13d\ncoredns-7f6cbbb7b8-snbdj                   1&#x2F;1     Running   3 (4h39m ago)   13d\netcd-k8s-master-22                         1&#x2F;1     Running   4 (25m ago)     13d\nkube-apiserver-k8s-master-22               1&#x2F;1     Running   6 (24m ago)     13d\nkube-controller-manager-k8s-master-22      1&#x2F;1     Running   4 (25m ago)     13d\nkube-proxy-c964g                           1&#x2F;1     Running   3 (4h40m ago)   13d\nkube-proxy-sdqxg                           1&#x2F;1     Running   3 (4h40m ago)   13d\nkube-scheduler-k8s-master-22               1&#x2F;1     Running   4 (25m ago)     13d</code></pre>\n<ol>\n<li>设置默认的命名空间<br>当前默认命名空间为default<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">kubectl get pod\n## 实际执行结果\n[root@k8s-master-22 ~]# kubectl get pod\nNAME                              READY   STATUS    RESTARTS        AGE\ncat-dp-58cf7df488-gf8h4           2&#x2F;2     Running   6 (4h42m ago)   13d\ndetails-v1-79f774bdb9-jd7tv       2&#x2F;2     Running   6 (4h42m ago)   13d\ndog-dp-b6c8757d4-dts8v            2&#x2F;2     Running   6 (4h42m ago)   13d\nproductpage-v1-6b746f74dc-slrjm   2&#x2F;2     Running   6 (4h42m ago)   13d\nratings-v1-b6994bb9-pnnss         2&#x2F;2     Running   6 (4h42m ago)   13d\nreviews-v1-545db77b95-8xl8k       2&#x2F;2     Running   6 (4h42m ago)   13d\nreviews-v2-7bf8c9648f-wklnd       2&#x2F;2     Running   6 (4h42m ago)   13d\nreviews-v3-84779c7bbc-ckb87       2&#x2F;2     Running   6 (4h42m ago)   13d\nkubectl get pod -n default\n## 实际执行结果\n[root@k8s-master-22 ~]# kubectl get pod -n default\nNAME                              READY   STATUS    RESTARTS        AGE\ncat-dp-58cf7df488-gf8h4           2&#x2F;2     Running   6 (4h43m ago)   13d\ndetails-v1-79f774bdb9-jd7tv       2&#x2F;2     Running   6 (4h43m ago)   13d\ndog-dp-b6c8757d4-dts8v            2&#x2F;2     Running   6 (4h43m ago)   13d\nproductpage-v1-6b746f74dc-slrjm   2&#x2F;2     Running   6 (4h43m ago)   13d\nratings-v1-b6994bb9-pnnss         2&#x2F;2     Running   6 (4h43m ago)   13d\nreviews-v1-545db77b95-8xl8k       2&#x2F;2     Running   6 (4h43m ago)   13d\nreviews-v2-7bf8c9648f-wklnd       2&#x2F;2     Running   6 (4h43m ago)   13d\nreviews-v3-84779c7bbc-ckb87       2&#x2F;2     Running   6 (4h43m ago)   13d</code></pre></li>\n<li>设置默认的命名空间为kube-system<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">kubectl config set-context --current --namespace&#x3D;kube-system\n## 实际执行结果\n[root@k8s-master-22 ~]# kubectl config set-context --current --namespace&#x3D;kube-system\nContext &quot;kubernetes-admin@kubernetes&quot; modified.\n\t\t\t\t\t\t  \n## 查看当前命名空间\nkubectl config view --minify | grep namespace:\n## 实际执行结果\n[root@k8s-master-22 ~]# kubectl config view --minify | grep namespace:\nnamespace: kube-system\n## 查看pod\nkubectl get pod\n## 实际执行结果\n[root@k8s-master-22 ~]# kubectl get pod\nNAME                                       READY   STATUS    RESTARTS        AGE\ncalico-kube-controllers-6fd7b9848d-4zlm5   1&#x2F;1     Running   3 (4h47m ago)   13d\ncalico-node-5c694                          1&#x2F;1     Running   3 (4h47m ago)   13d\ncalico-node-qgtxj                          1&#x2F;1     Running   3 (4h47m ago)   13d\ncoredns-7f6cbbb7b8-r4px6                   1&#x2F;1     Running   3 (4h47m ago)   13d\ncoredns-7f6cbbb7b8-snbdj                   1&#x2F;1     Running   3 (4h47m ago)   13d\netcd-k8s-master-22                         1&#x2F;1     Running   4 (32m ago)     13d\nkube-apiserver-k8s-master-22               1&#x2F;1     Running   6 (32m ago)     13d\nkube-controller-manager-k8s-master-22      1&#x2F;1     Running   4 (32m ago)     13d\nkube-proxy-c964g                           1&#x2F;1     Running   3 (4h47m ago)   13d\nkube-proxy-sdqxg                           1&#x2F;1     Running   3 (4h47m ago)   13d\nkube-scheduler-k8s-master-22               1&#x2F;1     Running   4 (32m ago)     13d\n## 还原默认的命名空间为default\nkubectl config set-context --current --namespace&#x3D;default\n## 查看当前默认的命名空间\nkubectl config view --minify | grep namespace:\t\t\t\t\t\t  </code></pre></li>\n</ol>\n<h2 id=\"命名空间和DNS\"><a href=\"#命名空间和DNS\" class=\"headerlink\" title=\"命名空间和DNS\"></a>命名空间和DNS</h2><ol>\n<li>创建一个服务(Service)，就会创建一个对应的DNS条目。</li>\n</ol>\n<ul>\n<li>条目形式： 该条目的形式是 &lt;服务名称&gt;.&lt;名字空间名称&gt;.svc.cluster.local</li>\n<li>解析：容器如果只使用服务名，它将被解析到本地名字空间的服务。</li>\n</ul>\n<ol start=\"2\">\n<li>并非所有的对象都在命名空间中</li>\n</ol>\n<ul>\n<li>大多数资源都位于某个命名空间中。<ul>\n<li>Deployment</li>\n<li>Pod</li>\n<li>Service</li>\n</ul>\n</li>\n<li>底层资源一般不在命名空间中<ul>\n<li>节点</li>\n<li>持久化卷</li>\n</ul>\n</li>\n</ul>\n<ol start=\"3\">\n<li>查看在命名空间和不在命名空间中的资源<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 位于名字空间中的资源\nkubectl api-resources --namespaced&#x3D;true\n\t\t\t\t\t\t  \n# 不在名字空间中的资源\nkubectl api-resources --namespaced&#x3D;false</code></pre></li>\n<li>实际的执行结果在命名空间中的资源<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">[root@k8s-master-22 ~]# kubectl api-resources --namespaced&#x3D;true\nNAME                        SHORTNAMES   APIVERSION                     NAMESPACED   KIND\nbindings                                 v1                             true         Binding\nconfigmaps                  cm           v1                             true         ConfigMap\nendpoints                   ep           v1                             true         Endpoints\nevents                      ev           v1                             true         Event\nlimitranges                 limits       v1                             true         LimitRange\npersistentvolumeclaims      pvc          v1                             true         PersistentVolumeClaim\npods                        po           v1                             true         Pod\npodtemplates                             v1                             true         PodTemplate\nreplicationcontrollers      rc           v1                             true         ReplicationController\nresourcequotas              quota        v1                             true         ResourceQuota\nsecrets                                  v1                             true         Secret\nserviceaccounts             sa           v1                             true         ServiceAccount\nservices                    svc          v1                             true         Service\ncontrollerrevisions                      apps&#x2F;v1                        true         ControllerRevision\ndaemonsets                  ds           apps&#x2F;v1                        true         DaemonSet\ndeployments                 deploy       apps&#x2F;v1                        true         Deployment\nreplicasets                 rs           apps&#x2F;v1                        true         ReplicaSet\nstatefulsets                sts          apps&#x2F;v1                        true         StatefulSet\nlocalsubjectaccessreviews                authorization.k8s.io&#x2F;v1        true         LocalSubjectAccessReview\nhorizontalpodautoscalers    hpa          autoscaling&#x2F;v1                true         \nHorizontalPodAutoscaler  cronjobs                    cj           batch&#x2F;v1                       true         \nCronJob  jobs                                     batch&#x2F;v1             true         Job\nleases                                   coordination.k8s.io&#x2F;v1         true         Lease\n networkpolicies                          crd.projectcalico.org&#x2F;v1       true         NetworkPolicy\nnetworksets                              crd.projectcalico.org&#x2F;v1       true         NetworkSet\nendpointslices                           discovery.k8s.io&#x2F;v1            true         EndpointSlice\n events                      ev           events.k8s.io&#x2F;v1               true         Event\nwasmplugins                              extensions.istio.io&#x2F;v1alpha1   true         WasmPlugin\nistiooperators              iop,io       install.istio.io&#x2F;v1alpha1      true         IstioOperator\ndestinationrules            dr           networking.istio.io&#x2F;v1beta1    true         DestinationRule\n envoyfilters                             networking.istio.io&#x2F;v1alpha3   true         EnvoyFilter\ngateways                    gw           networking.istio.io&#x2F;v1beta1    true         Gateway\nserviceentries              se           networking.istio.io&#x2F;v1beta1    true         ServiceEntry\nsidecars                                 networking.istio.io&#x2F;v1beta1    true         Sidecar\nvirtualservices             vs           networking.istio.io&#x2F;v1beta1    true         VirtualService\nworkloadentries             we           networking.istio.io&#x2F;v1beta1    true         WorkloadEntry\nworkloadgroups              wg           networking.istio.io&#x2F;v1alpha3   true         WorkloadGroup\ningresses                   ing          networking.k8s.io&#x2F;v1           true         Ingress\nnetworkpolicies             netpol       networking.k8s.io&#x2F;v1           true         NetworkPolicy\npoddisruptionbudgets        pdb          policy&#x2F;v1                      true         PodDisruptionBudget\nrolebindings                             rbac.authorization.k8s.io&#x2F;v1   true         RoleBinding\nroles                                    rbac.authorization.k8s.io&#x2F;v1   true         Role\nauthorizationpolicies                    security.istio.io&#x2F;v1beta1      true         AuthorizationPolicy\npeerauthentications         pa           security.istio.io&#x2F;v1beta1      true         PeerAuthentication\nrequestauthentications      ra           security.istio.io&#x2F;v1beta1      true         RequestAuthentication\ncsistoragecapacities                     storage.k8s.io&#x2F;v1beta1         true         CSIStorageCapacity\ntelemetries                 telemetry    telemetry.istio.io&#x2F;v1alpha1    true         Telemetry</code></pre></li>\n<li>不在命名空间中的资源<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">[root@k8s-master-22 ~]# kubectl api-resources --namespaced&#x3D;false\nNAME      SHORTNAMES   APIVERSION        NAMESPACED   KIND\ncomponentstatuses                 cs           v1                                     false        ComponentStatus\nnamespaces                        ns           v1                                     false        Namespace\nnodes                             no           v1                                     false        Node\npersistentvolumes                 pv           v1                                     false        PersistentVolume\nmutatingwebhookconfigurations                  admissionregistration.k8s.io&#x2F;v1        false        MutatingWebhookConfiguration\nvalidatingwebhookconfigurations                admissionregistration.k8s.io&#x2F;v1        false        ValidatingWebhookConfiguration\ncustomresourcedefinitions         crd,crds     apiextensions.k8s.io&#x2F;v1                false        CustomResourceDefinition\napiservices                                    apiregistration.k8s.io&#x2F;v1              false        APIService\n tokenreviews                                   authentication.k8s.io&#x2F;v1               false        TokenReview\nselfsubjectaccessreviews                       authorization.k8s.io&#x2F;v1                false        SelfSubjectAccessReview\nselfsubjectrulesreviews                        authorization.k8s.io&#x2F;v1                false        SelfSubjectRulesReview\nsubjectaccessreviews                           authorization.k8s.io&#x2F;v1                false        SubjectAccessReview\ncertificatesigningrequests        csr          certificates.k8s.io&#x2F;v1                 false        CertificateSigningRequest\nbgpconfigurations                              crd.projectcalico.org&#x2F;v1               false        BGPConfiguration\nbgppeers                                       crd.projectcalico.org&#x2F;v1               false        BGPPeer\nblockaffinities                                crd.projectcalico.org&#x2F;v1               false        BlockAffinity\ncaliconodestatuses                             crd.projectcalico.org&#x2F;v1               false        CalicoNodeStatus\nclusterinformations                            crd.projectcalico.org&#x2F;v1               false        ClusterInformation\nfelixconfigurations                            crd.projectcalico.org&#x2F;v1               false        FelixConfiguration\nglobalnetworkpolicies                          crd.projectcalico.org&#x2F;v1               false        GlobalNetworkPolicy\nglobalnetworksets                              crd.projectcalico.org&#x2F;v1               false        GlobalNetworkSet\nhostendpoints                                  crd.projectcalico.org&#x2F;v1               false        HostEndpoint\nipamblocks                                     crd.projectcalico.org&#x2F;v1               false        IPAMBlock\nipamconfigs                                    crd.projectcalico.org&#x2F;v1               false        IPAMConfig\nipamhandles                                    crd.projectcalico.org&#x2F;v1               false        IPAMHandle\nippools                                        crd.projectcalico.org&#x2F;v1               false        IPPool\nipreservations                                 crd.projectcalico.org&#x2F;v1               false        IPReservation\nkubecontrollersconfigurations                  crd.projectcalico.org&#x2F;v1               false        KubeControllersConfiguration\nflowschemas                                    flowcontrol.apiserver.k8s.io&#x2F;v1beta1   false        FlowSchema\nprioritylevelconfigurations                    flowcontrol.apiserver.k8s.io&#x2F;v1beta1   false        PriorityLevelConfiguration\ningressclasses                                 networking.k8s.io&#x2F;v1                   false        IngressClass\nruntimeclasses                                 node.k8s.io&#x2F;v1                         false        RuntimeClass\npodsecuritypolicies               psp          policy&#x2F;v1beta1                         false        PodSecurityPolicy\nclusterrolebindings                            rbac.authorization.k8s.io&#x2F;v1           false        ClusterRoleBinding\nclusterroles                                   rbac.authorization.k8s.io&#x2F;v1           false        ClusterRole\npriorityclasses                   pc           scheduling.k8s.io&#x2F;v1                   false        PriorityClass\ncsidrivers                                     storage.k8s.io&#x2F;v1                      false        CSIDriver\ncsinodes                                       storage.k8s.io&#x2F;v1                      false        CSINode\nstorageclasses                    sc           storage.k8s.io&#x2F;v1                      false        StorageClass\nvolumeattachments                              storage.k8s.io&#x2F;v1                      false        VolumeAttachment</code></pre></li>\n</ol>\n<h2 id=\"自动打标签\"><a href=\"#自动打标签\" class=\"headerlink\" title=\"自动打标签\"></a>自动打标签</h2><p>Kubernetes 控制面会为所有命名空间设置一个不可变更的 标签 <code>kubernetes.io/metadata.name</code>，只要 NamespaceDefaultLabelName 这一 特性被启用。标签的值是名字空间的名称。</p>\n<h3 id=\"标签和选择算符\"><a href=\"#标签和选择算符\" class=\"headerlink\" title=\"标签和选择算符\"></a>标签和选择算符</h3><p><a href=\"https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/labels/\">官方文档</a></p>\n<h3 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h3><p>作用范围：附加到Kubernetes对象，例如Pods，Deployment等。</p>\n<h3 id=\"用途\"><a href=\"#用途\" class=\"headerlink\" title=\"用途\"></a>用途</h3><ul>\n<li>对用户有意义。</li>\n<li>不直接对核心系统有语义含义。</li>\n<li>用于组合和选择对象的子集。</li>\n</ul>\n<h3 id=\"规范\"><a href=\"#规范\" class=\"headerlink\" title=\"规范\"></a>规范</h3><ul>\n<li>每个对象可以定义一组建&#x2F;值标签。</li>\n<li>每个建对于给定的对象必须是唯一的。</li>\n</ul>\n<h3 id=\"动机\"><a href=\"#动机\" class=\"headerlink\" title=\"动机\"></a>动机</h3><ul>\n<li>标签使用户能够以松散耦合的方式将他们自己的组织结构映射到系统对象，而无需客户端存储这些映射。  即可以动态的，按照客户的要求来组织对象的集合，而非固定的记录对象集合。</li>\n<li>服务部署和批处理流水线通常是多维实体（例如，多个分区或部署、多个发行序列、多个层，每层多个微服务）。</li>\n</ul>\n<h3 id=\"示例标签\"><a href=\"#示例标签\" class=\"headerlink\" title=\"示例标签\"></a>示例标签</h3><pre class=\"line-numbers language-markdown\" data-language=\"markdown\"><code class=\"language-markdown\">&quot;release&quot; : &quot;stable&quot;, &quot;release&quot; : &quot;canary&quot;\n&quot;environment&quot; : &quot;dev&quot;, &quot;environment&quot; : &quot;qa&quot;, &quot;environment&quot; : &quot;production&quot;\n&quot;tier&quot; : &quot;frontend&quot;, &quot;tier&quot; : &quot;backend&quot;, &quot;tier&quot; : &quot;cache&quot;\n&quot;partition&quot; : &quot;customerA&quot;, &quot;partition&quot; : &quot;customerB&quot;\n&quot;track&quot; : &quot;daily&quot;, &quot;track&quot; : &quot;weekly&quot;</code></pre>\n<h2 id=\"语法和字符集\"><a href=\"#语法和字符集\" class=\"headerlink\" title=\"语法和字符集\"></a>语法和字符集</h2><p> 标签 是键值对。有效的标签键有两个段：可选的前缀和名称，用斜杠（&#x2F;）分隔。 名称段是必需的，必须小于等于 63 个字符，以字母数字字符（[a-z0-9A-Z]）开头和结尾， 带有破折号（-），下划线（_），点（ .）和之间的字母数字。 前缀是可选的。如果指定，前缀必须是 DNS 子域：由点（.）分隔的一系列 DNS 标签，总共不超过 253 个字符， 后跟斜杠（&#x2F;）。<br>kubernetes.io&#x2F; 和 k8s.io&#x2F; 前缀是为 Kubernetes 核心组件保留的。</p>\n<h3 id=\"有效标签值：\"><a href=\"#有效标签值：\" class=\"headerlink\" title=\"有效标签值：\"></a>有效标签值：</h3><p>必须为 63 个字符或更少（可以为空）<br>                              除非标签值为空，必须以字母数字字符（[a-z0-9A-Z]）开头和结尾<br>                              包含破折号（-）、下划线（_）、点（.）和字母或数字。</p>\n<h3 id=\"标签选择算符\"><a href=\"#标签选择算符\" class=\"headerlink\" title=\"标签选择算符\"></a>标签选择算符</h3><h4 id=\"基于等值的需求-等于\"><a href=\"#基于等值的需求-等于\" class=\"headerlink\" title=\"基于等值的需求-等于\"></a>基于等值的需求-等于</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">kubectl get pod -l app&#x3D;cat</code></pre>\n<h4 id=\"不等于\"><a href=\"#不等于\" class=\"headerlink\" title=\"不等于\"></a>不等于</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">kubectl get pod -l app!&#x3D;cat</code></pre>\n<h4 id=\"基于集合的需求-in\"><a href=\"#基于集合的需求-in\" class=\"headerlink\" title=\"基于集合的需求-in\"></a>基于集合的需求-in</h4> <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">## 选取cat和dog\nkubectl get pod -l &quot;app in (cat,dog)&quot;\n\t\t\t\t\t\t\t\t  \n## 实际执行结果\n[root@k8s-master-22 deployment]# kubectl get pod -l &quot;app in (cat,dog)&quot;\nNAME                      READY   STATUS    RESTARTS   AGE\ncat-dp-58cf7df488-dcs4g   2&#x2F;2     Running   0          25m\ncat-dp-58cf7df488-hk4fb   2&#x2F;2     Running   0          26m\ndog-dp-b6c8757d4-t5vnv    2&#x2F;2     Running   0          26m</code></pre>\n<h4 id=\"基于集合的需求-notin\"><a href=\"#基于集合的需求-notin\" class=\"headerlink\" title=\"基于集合的需求- notin\"></a>基于集合的需求- notin</h4> <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">## 选取非cat，非dog\nkubectl get pod -l &quot;app notin (cat,dog)&quot;\n\t\t\t\t\t\t\t\t  \n## 实际执行结果\n[root@k8s-master-22 deployment]# kubectl get pod -l &quot;app notin (cat,dog)&quot;\nNAME                              READY   STATUS    RESTARTS         AGE\ndetails-v1-79f774bdb9-jd7tv       2&#x2F;2     Running   12 (3h59m ago)   13d\nmonkey-dp-65686cb678-pvk87        2&#x2F;2     Running   0                7m17s\nproductpage-v1-6b746f74dc-slrjm   2&#x2F;2     Running   12 (3h59m ago)   13d\nratings-v1-b6994bb9-pnnss         2&#x2F;2     Running   12 (3h58m ago)   13d\nreviews-v1-545db77b95-8xl8k       2&#x2F;2     Running   12 (3h59m ago)   13d\nreviews-v2-7bf8c9648f-wklnd       2&#x2F;2     Running   12 (3h59m ago)   13d\nreviews-v3-84779c7bbc-ckb87       2&#x2F;2     Running   12 (3h59m ago)   13d</code></pre>\n<h4 id=\"基于集合的需求-exist\"><a href=\"#基于集合的需求-exist\" class=\"headerlink\" title=\"基于集合的需求- exist\"></a>基于集合的需求- exist</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">## 选取存在env标签的pod\nkubectl get pod -l env\n ## 执行结果\n[root@k8s-master-22 deployment]# kubectl get pod -l env\nNAME                         READY   STATUS    RESTARTS   AGE\ncat-dp-58cf7df488-dcs4g      2&#x2F;2     Running   0          54m\ncat-dp-58cf7df488-hk4fb      2&#x2F;2     Running   0          55m\ndog-dp-b6c8757d4-t5vnv       2&#x2F;2     Running   0          55m\nmonkey-dp-65686cb678-pvk87   2&#x2F;2     Running   0          35m\n[root@k8s-master-22 deployment]#\n## 选取不存在env标签的pod\nkubectl get pod -l &quot;! env&quot;\n## 实际执行结果\n[root@k8s-master-22 deployment]# kubectl get pod -l &quot;! env&quot;\nNAME                              READY   STATUS    RESTARTS       AGE\ndetails-v1-79f774bdb9-jd7tv       2&#x2F;2     Running   26 (15h ago)   15d\nproductpage-v1-6b746f74dc-slrjm   2&#x2F;2     Running   26 (15h ago)   15d\nratings-v1-b6994bb9-pnnss         2&#x2F;2     Running   26 (15h ago)   15d\nreviews-v1-545db77b95-8xl8k       2&#x2F;2     Running   26 (15h ago)   15d\nreviews-v2-7bf8c9648f-wklnd       2&#x2F;2     Running   26 (15h ago)   15d\nreviews-v3-84779c7bbc-ckb87       2&#x2F;2     Running   26 (15h ago)   15d</code></pre>\n<h4 id=\"基于集合的需求多条件-amp-amp\"><a href=\"#基于集合的需求多条件-amp-amp\" class=\"headerlink\" title=\"基于集合的需求多条件&amp;&amp;\"></a>基于集合的需求多条件&amp;&amp;</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">## 选取app&#x3D;cat并且env&#x3D;prod的pod\nkubectl get pod -l app&#x3D;cat,env&#x3D;prod\n## 实际执行结果\n[root@k8s-master-22 deployment]# kubectl get pod -l app&#x3D;cat,env&#x3D;prod\nNAME                          READY   STATUS    RESTARTS   AGE\ncat-dp-prod-7b4c9b4f8-6wrh8   2&#x2F;2     Running   0          73s\ncat-dp-prod-7b4c9b4f8-8k7hf   2&#x2F;2     Running   0          73s\n## 选取不带env标签的pod\nkubectl get pod -l &quot;! env&quot;\n## 实际执行结果\n[root@k8s-master-22 deployment]# kubectl get pod -l &quot;! env&quot;\nNAME                              READY   STATUS    RESTARTS         AGE\ndetails-v1-79f774bdb9-jd7tv       2&#x2F;2     Running   12 (4h50m ago)   13d\nproductpage-v1-6b746f74dc-slrjm   2&#x2F;2     Running   12 (4h50m ago)   13d\nratings-v1-b6994bb9-pnnss         2&#x2F;2     Running   12 (4h49m ago)   13d\nreviews-v1-545db77b95-8xl8k       2&#x2F;2     Running   12 (4h50m ago)   13d\nreviews-v2-7bf8c9648f-wklnd       2&#x2F;2     Running   12 (4h50m ago)   13d\nreviews-v3-84779c7bbc-ckb87       2&#x2F;2     Running   12 (4h50m ago)   13d</code></pre>\n<h1 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h1><p>LIST和WATCH过滤<br>在API对象中设置引用</p>\n<ul>\n<li>Service和ReplicationController</li>\n<li>支持基于集合需求的资源</li>\n<li>选择节点集<br><a href=\"https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/annotations/\">官方文档</a></li>\n</ul>\n<h2 id=\"为对象附加元数据\"><a href=\"#为对象附加元数据\" class=\"headerlink\" title=\"为对象附加元数据\"></a>为对象附加元数据</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">## 例如\nannotations:\nauthor: catface996\n## 在cat-dp-gray.yaml 中配置    \n[root@k8s-master-22 deployment]# cat cat-dp-gray.yaml\napiVersion: apps&#x2F;v1\nkind: Deployment\nmetadata:\nname: cat-dp-gray\nannotations:\nauthor: catface996\n\tspec:\n\tselector:\n\tmatchLabels:\n\tapp: cat\n\t\tenv: gray\n\t\t\t\t\t    replicas: 2\n\t\t\t\t\t    template:\n\t\t\t\t\t      metadata:\n\t\t\t\t\t        labels:\n\t\t\t\t\t          app: cat\n\t\t\t\t\t          env: gray\n\t\t\t\t\t      spec:\n\t\t\t\t\t        containers:\n\t\t\t\t\t          - name: cat-ct-gray\n\t\t\t\t\t            image: catface996&#x2F;spring-cloud-istio-demo:latest\n\t\t\t\t\t            ports:\n\t\t\t\t\t              - containerPort: 9001\n\t\t\t\t\t                protocol: TCP\n\t\t\t\t\t                \n## 配置生效后\n[root@k8s-master-22 deployment]# kubectl describe deployment cat-dp-gray\nName:                   cat-dp-gray\nNamespace:              default\nCreationTimestamp:      Mon, 25 Apr 2022 08:15:44 -0400\nLabels:                 &lt;none&gt;\nAnnotations:            author: catface99\ndeployment.kubernetes.io&#x2F;revision: 1\n\t\t\t\t\t  Selector:               app&#x3D;cat,env&#x3D;gray\n\t\t\t\t\t  Replicas:               2 desired | 2 updated | 2 total | 2 available | 0 unavailable\n\t\t\t\t\t  StrategyType:           RollingUpdate\n\t\t\t\t\t  MinReadySeconds:        0\n\t\t\t\t\t  RollingUpdateStrategy:  25% max unavailable, 25% max surge\n\t\t\t\t\t  Pod Template:\n\t\t\t\t\t    Labels:  app&#x3D;cat\n\t\t\t\t\t             env&#x3D;gray\n\t\t\t\t\t    Containers:\n\t\t\t\t\t     cat-ct-gray:\n\t\t\t\t\t      Image:        catface996&#x2F;spring-cloud-istio-demo:latest\n\t\t\t\t\t      Port:         9001&#x2F;TCP\n\t\t\t\t\t      Host Port:    0&#x2F;TCP\n\t\t\t\t\t      Environment:  &lt;none&gt;\n\t\t\t\t\t      Mounts:       &lt;none&gt;\n\t\t\t\t\t    Volumes:        &lt;none&gt;\n\t\t\t\t\t  Conditions:\n\t\t\t\t\t    Type           Status  Reason\n\t\t\t\t\t    ----           ------  ------\n\t\t\t\t\t    Progressing    True    NewReplicaSetAvailable\n\t\t\t\t\t    Available      True    MinimumReplicasAvailable\n\t\t\t\t\t  OldReplicaSets:  &lt;none&gt;\n\t\t\t\t\t  NewReplicaSet:   cat-dp-gray-79545bc67d (2&#x2F;2 replicas created)\n\t\t\t\t\t  Events:\n\t\t\t\t\t    Type    Reason             Age   From                   Message\n\t\t\t\t\t    ----    ------             ----  ----                   -------\n\t\t\t\t\t    Normal  ScalingReplicaSet  24m   deployment-controller  Scaled up replica set cat-dp-gray-79545bc67d to 2\n\t\t\t\t\t                </code></pre>\n<h2 id=\"常用的例子\"><a href=\"#常用的例子\" class=\"headerlink\" title=\"常用的例子\"></a>常用的例子</h2><p>由声明性配置所管理的字段。 将这些字段附加为注解，能够将它们与客户端或服务端设置的默认值、 自动生成的字段以及通过自动调整大小或自动伸缩系统设置的字段区分开来。</p>\n<ul>\n<li>构建、发布或镜像信息（如时间戳、发布 ID、Git 分支、PR 数量、镜像哈希、仓库地址）。</li>\n<li>指向日志记录、监控、分析或审计仓库的指针。</li>\n<li>可用于调试目的的客户端库或工具信息：例如，名称、版本和构建信息。</li>\n<li>用户或者工具&#x2F;系统的来源信息，例如来自其他生态系统组件的相关对象的 URL。</li>\n<li>轻量级上线工具的元数据信息：例如，配置或检查点。</li>\n<li>负责人员的电话或呼机号码，或指定在何处可以找到该信息的目录条目，如团队网站。<br> 从用户到最终运行的指令，以修改行为或使用非标准功能。</li>\n</ul>\n<h2 id=\"语法和字符集-1\"><a href=\"#语法和字符集-1\" class=\"headerlink\" title=\"语法和字符集\"></a>语法和字符集</h2><p>注意： kubernetes.io&#x2F; 和 k8s.io&#x2F; 前缀是为Kubernetes核心组件保留的。</p>\n<h3 id=\"Finalizers\"><a href=\"#Finalizers\" class=\"headerlink\" title=\"Finalizers\"></a>Finalizers</h3><p> <a href=\"https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/finalizers/\">官方文档</a></p>\n<h4 id=\"字段选择器\"><a href=\"#字段选择器\" class=\"headerlink\" title=\"字段选择器\"></a>字段选择器</h4><p> <a href=\"https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/field-selectors/\">官方文档</a></p>\n<h3 id=\"属主与附属\"><a href=\"#属主与附属\" class=\"headerlink\" title=\"属主与附属\"></a>属主与附属</h3><p> <a href=\"https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/owners-dependents/\">官方文档</a></p>\n<h3 id=\"推荐使用的标签\"><a href=\"#推荐使用的标签\" class=\"headerlink\" title=\"推荐使用的标签\"></a>推荐使用的标签</h3><p><a href=\"https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/common-labels/\">官方文档</a></p>\n<h1 id=\"Kubernetes架构\"><a href=\"#Kubernetes架构\" class=\"headerlink\" title=\"Kubernetes架构\"></a>Kubernetes架构</h1><ul>\n<li>容器</li>\n<li>工作负载</li>\n<li>服务、负载均衡和联网<br><a href=\"https://kubernetes.io/zh/docs/concepts/services-networking/\">官方文档</a><br>  - Ingress<br> <a href=\"https://kubernetes.github.io/ingress-nginx/deploy/\">Ingress nginx</a></li>\n</ul>\n<h2 id=\"部署命令：\"><a href=\"#部署命令：\" class=\"headerlink\" title=\"部署命令：\"></a>部署命令：</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">kubectl apply -f https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;kubernetes&#x2F;ingress-nginx&#x2F;controller-v1.2.0&#x2F;deploy&#x2F;static&#x2F;provider&#x2F;cloud&#x2F;deploy.yaml</code></pre>\n<h3 id=\"使用到的镜像\"><a href=\"#使用到的镜像\" class=\"headerlink\" title=\"使用到的镜像\"></a>使用到的镜像</h3><pre class=\"line-numbers language-markdown\" data-language=\"markdown\"><code class=\"language-markdown\"> k8s.gcr.io&#x2F;ingress-nginx&#x2F;controller:v1.2.0\n k8s.gcr.io&#x2F;ingress-nginx&#x2F;kube-webhook-certgen:v1.1.1\nregistry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;nginx-ingress-controller:v1.2.0\nregistry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;kube-webhook-certgen:v1.1.1</code></pre>\n<ul>\n<li>Ingress控制器</li>\n<li>存储</li>\n<li>配置</li>\n<li>安全</li>\n<li>策略</li>\n<li>调度，抢占和驱逐<ul>\n<li><a href=\"https://kubernetes.io/zh/docs/concepts/scheduling-eviction/\">官方文档</a></li>\n<li><a href=\"https://kubernetes.io/zh/docs/concepts/scheduling-eviction/assign-pod-node/\">将Pods指派到节点</a></li>\n</ul>\n</li>\n<li>集群管理</li>\n<li>扩展Kubernetes</li>\n<li>任务<ul>\n<li><a href=\"https://kubernetes.io/zh/docs/tasks/\">官方文档</a></li>\n<li>运行应用<ul>\n<li><a href=\"https://kubernetes.io/zh/docs/tasks/run-application/\">官方文档</a></li>\n<li>Pod 水平自动扩缩<ul>\n<li><a href=\"https://kubernetes.io/zh/docs/tasks/run-application/horizontal-pod-autoscale/\">官方文档</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n","feature":true,"text":"概述官网地址 Kubernetes是什么?官网地址 时光回溯[[History of cloud]] 传统部署时代例如：安装Oracle 针对操作系统准备安装包(下载或者U盘拷贝) 安装Oracle需要的基础类库 配置操作系统的相应配置 执行安装检查，安装命令 安装失败之后，要完...","link":"","photos":[],"count_time":{"symbolsCount":"28k","symbolsTime":"26 mins."},"categories":[{"name":"Cloud-Native","slug":"Cloud-Native","count":1,"path":"api/categories/Cloud-Native.json"}],"tags":[{"name":"分布式系统","slug":"分布式系统","count":3,"path":"api/tags/分布式系统.json"},{"name":"k8s","slug":"k8s","count":1,"path":"api/tags/k8s.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%A6%82%E8%BF%B0\"><span class=\"toc-text\">概述</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%97%B6%E5%85%89%E5%9B%9E%E6%BA%AF-History-of-cloud\"><span class=\"toc-text\">时光回溯[[History of cloud]]</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BC%A0%E7%BB%9F%E9%83%A8%E7%BD%B2%E6%97%B6%E4%BB%A3\"><span class=\"toc-text\">传统部署时代</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%99%9A%E6%8B%9F%E5%8C%96%E9%83%A8%E7%BD%B2%E6%97%B6%E4%BB%A3\"><span class=\"toc-text\">虚拟化部署时代</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%B9%E5%99%A8%E9%83%A8%E7%BD%B2%E6%97%B6%E4%BB%A3\"><span class=\"toc-text\">容器部署时代</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81Kubernetes-%E5%AE%83%E8%83%BD%E5%81%9A%E4%BB%80%E4%B9%88\"><span class=\"toc-text\">为什么需要Kubernetes,它能做什么?</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Kubernetes%E4%B8%8D%E6%98%AF%E4%BB%80%E4%B9%88\"><span class=\"toc-text\">Kubernetes不是什么</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Kubernetes%E7%BB%84%E4%BB%B6\"><span class=\"toc-text\">Kubernetes组件</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%8E%A7%E5%88%B6%E5%B9%B3%E9%9D%A2%E7%BB%84%E4%BB%B6-Control-Plane-Components\"><span class=\"toc-text\">控制平面组件(Control Plane Components)</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#etcd\"><span class=\"toc-text\">etcd</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AE%80%E4%BB%8B\"><span class=\"toc-text\">简介</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%89%B9%E7%82%B9\"><span class=\"toc-text\">特点</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AF%B9%E6%AF%94VSConsul-Zookeeper\"><span class=\"toc-text\">对比VSConsul Zookeeper</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%B8%A4%E5%A4%A7%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF\"><span class=\"toc-text\">两大使用场景</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#kube-scheduler\"><span class=\"toc-text\">kube-scheduler</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%B0%83%E5%BA%A6%E5%86%B3%E7%AD%96%E8%80%83%E8%99%91%E7%9A%84%E5%9B%A0%E7%B4%A0%E5%8C%85%E6%8B%AC\"><span class=\"toc-text\">调度决策考虑的因素包括</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#kube-controller-manager\"><span class=\"toc-text\">kube-controller-manager</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#cloud-controller-manager\"><span class=\"toc-text\">cloud-controller-manager</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Node%E7%BB%84%E4%BB%B6\"><span class=\"toc-text\">Node组件</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#kubelet\"><span class=\"toc-text\">kubelet</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#kube-proxy\"><span class=\"toc-text\">kube-proxy</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%8F%92%E4%BB%B6-Addon\"><span class=\"toc-text\">插件(Addon)</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#DNS\"><span class=\"toc-text\">DNS</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#KubernetesAPI\"><span class=\"toc-text\">KubernetesAPI</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8Kubernetes%E5%AF%B9%E8%B1%A1\"><span class=\"toc-text\">使用Kubernetes对象</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">总结</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%AF%B9%E8%B1%A1%E8%A7%84%E7%BA%A6%EF%BC%88Spec%EF%BC%89%E4%B8%8E%E7%8A%B6%E6%80%81%EF%BC%88Status%EF%BC%89\"><span class=\"toc-text\">对象规约（Spec）与状态（Status）</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Kubernetes%E5%AF%B9%E8%B1%A1%E7%AE%A1%E7%90%86\"><span class=\"toc-text\">Kubernetes对象管理</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%AE%A1%E7%90%86%E6%8A%80%E5%B7%A7\"><span class=\"toc-text\">管理技巧</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%8C%87%E4%BB%A4%E5%BC%8F%E5%91%BD%E4%BB%A4\"><span class=\"toc-text\">指令式命令</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BE%8B%E5%AD%90\"><span class=\"toc-text\">例子</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9D%83%E8%A1%A1\"><span class=\"toc-text\">权衡</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%8C%87%E4%BB%A4%E5%BC%8F%E5%AF%B9%E8%B1%A1%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">指令式对象配置</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BE%8B%E5%AD%90-1\"><span class=\"toc-text\">例子</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9D%83%E8%A1%A1-1\"><span class=\"toc-text\">权衡</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%B8%8E%E6%89%A7%E8%A1%8C%E4%BB%A4%E5%BC%8F%E5%91%BD%E4%BB%A4%E7%9B%B8%E6%AF%94%E4%BC%98%E7%82%B9\"><span class=\"toc-text\">与执行令式命令相比优点</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%B8%8E%E6%89%A7%E8%A1%8C%E4%BB%A4%E5%BC%8F%E5%91%BD%E4%BB%A4%E7%9B%B8%E6%AF%94%E7%BC%BA%E7%82%B9%EF%BC%9A\"><span class=\"toc-text\">与执行令式命令相比缺点：</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%B8%8E%E5%A3%B0%E6%98%8E%E5%BC%8F%E5%AF%B9%E8%B1%A1%E9%85%8D%E7%BD%AE%E7%9B%B8%E6%AF%94%E4%BC%98%E7%82%B9%EF%BC%9A\"><span class=\"toc-text\">与声明式对象配置相比优点：</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%B8%8E%E5%A3%B0%E6%98%8E%E5%BC%8F%E5%AF%B9%E8%B1%A1%E9%85%8D%E7%BD%AE%E7%9B%B8%E6%AF%94%E7%BC%BA%E7%82%B9%EF%BC%9A\"><span class=\"toc-text\">与声明式对象配置相比缺点：</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A3%B0%E6%98%8E%E5%BC%8F%E5%AF%B9%E8%B1%A1%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">声明式对象配置</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BE%8B%E5%AD%90-2\"><span class=\"toc-text\">例子</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9D%83%E8%A1%A1-2\"><span class=\"toc-text\">权衡</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%B8%8E%E6%8C%87%E4%BB%A4%E5%BC%8F%E5%AF%B9%E8%B1%A1%E9%85%8D%E7%BD%AE%E7%9B%B8%E6%AF%94%E4%BC%98%E7%82%B9%EF%BC%9A\"><span class=\"toc-text\">与指令式对象配置相比优点：</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%B8%8E%E6%8C%87%E4%BB%A4%E5%BC%8F%E5%AF%B9%E8%B1%A1%E9%85%8D%E7%BD%AE%E7%9B%B8%E6%AF%94%E7%BC%BA%E7%82%B9%EF%BC%9A\"><span class=\"toc-text\">与指令式对象配置相比缺点：</span></a></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%88%86%E6%9E%90%E5%B7%A5%E4%BD%9C%E5%9C%BA%E6%99%AF%EF%BC%8C%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E7%9A%84%E6%96%B9%E6%A1%88\"><span class=\"toc-text\">分析工作场景，选择合适的方案</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%BF%90%E7%BB%B4%E4%B8%AD%E8%A6%81%E8%A7%A3%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98\"><span class=\"toc-text\">运维中要解决的问题</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%AF%B9%E8%B1%A1%E5%90%8D%E7%A7%B0%E5%92%8CIDs\"><span class=\"toc-text\">对象名称和IDs</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4\"><span class=\"toc-text\">命名空间</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BD%9C%E7%94%A8\"><span class=\"toc-text\">作用</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%99%90%E5%88%B6\"><span class=\"toc-text\">限制</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BD%95%E6%97%B6%E4%BD%BF%E7%94%A8%E5%A4%9A%E4%B8%AA%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4\"><span class=\"toc-text\">何时使用多个命名空间</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4\"><span class=\"toc-text\">使用命名空间</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Kubernetes%E4%BC%9A%E5%88%9B%E5%BB%BA%E5%9B%9B%E4%B8%AA%E5%88%9D%E5%A7%8B%E7%9A%84%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4\"><span class=\"toc-text\">Kubernetes会创建四个初始的命名空间</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%93%8D%E4%BD%9C%E6%8C%87%E5%AE%9A%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4\"><span class=\"toc-text\">操作指定命名空间</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E5%92%8CDNS\"><span class=\"toc-text\">命名空间和DNS</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%87%AA%E5%8A%A8%E6%89%93%E6%A0%87%E7%AD%BE\"><span class=\"toc-text\">自动打标签</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%A0%87%E7%AD%BE%E5%92%8C%E9%80%89%E6%8B%A9%E7%AE%97%E7%AC%A6\"><span class=\"toc-text\">标签和选择算符</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%8B%E7%BB%8D\"><span class=\"toc-text\">介绍</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%94%A8%E9%80%94\"><span class=\"toc-text\">用途</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%A7%84%E8%8C%83\"><span class=\"toc-text\">规范</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%8A%A8%E6%9C%BA\"><span class=\"toc-text\">动机</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%A4%BA%E4%BE%8B%E6%A0%87%E7%AD%BE\"><span class=\"toc-text\">示例标签</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%AF%AD%E6%B3%95%E5%92%8C%E5%AD%97%E7%AC%A6%E9%9B%86\"><span class=\"toc-text\">语法和字符集</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9C%89%E6%95%88%E6%A0%87%E7%AD%BE%E5%80%BC%EF%BC%9A\"><span class=\"toc-text\">有效标签值：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%A0%87%E7%AD%BE%E9%80%89%E6%8B%A9%E7%AE%97%E7%AC%A6\"><span class=\"toc-text\">标签选择算符</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%9F%BA%E4%BA%8E%E7%AD%89%E5%80%BC%E7%9A%84%E9%9C%80%E6%B1%82-%E7%AD%89%E4%BA%8E\"><span class=\"toc-text\">基于等值的需求-等于</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%B8%8D%E7%AD%89%E4%BA%8E\"><span class=\"toc-text\">不等于</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%9F%BA%E4%BA%8E%E9%9B%86%E5%90%88%E7%9A%84%E9%9C%80%E6%B1%82-in\"><span class=\"toc-text\">基于集合的需求-in</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%9F%BA%E4%BA%8E%E9%9B%86%E5%90%88%E7%9A%84%E9%9C%80%E6%B1%82-notin\"><span class=\"toc-text\">基于集合的需求- notin</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%9F%BA%E4%BA%8E%E9%9B%86%E5%90%88%E7%9A%84%E9%9C%80%E6%B1%82-exist\"><span class=\"toc-text\">基于集合的需求- exist</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%9F%BA%E4%BA%8E%E9%9B%86%E5%90%88%E7%9A%84%E9%9C%80%E6%B1%82%E5%A4%9A%E6%9D%A1%E4%BB%B6-amp-amp\"><span class=\"toc-text\">基于集合的需求多条件&amp;&amp;</span></a></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#API\"><span class=\"toc-text\">API</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%BA%E5%AF%B9%E8%B1%A1%E9%99%84%E5%8A%A0%E5%85%83%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">为对象附加元数据</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%B8%B8%E7%94%A8%E7%9A%84%E4%BE%8B%E5%AD%90\"><span class=\"toc-text\">常用的例子</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%AF%AD%E6%B3%95%E5%92%8C%E5%AD%97%E7%AC%A6%E9%9B%86-1\"><span class=\"toc-text\">语法和字符集</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Finalizers\"><span class=\"toc-text\">Finalizers</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%AD%97%E6%AE%B5%E9%80%89%E6%8B%A9%E5%99%A8\"><span class=\"toc-text\">字段选择器</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B1%9E%E4%B8%BB%E4%B8%8E%E9%99%84%E5%B1%9E\"><span class=\"toc-text\">属主与附属</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%E7%9A%84%E6%A0%87%E7%AD%BE\"><span class=\"toc-text\">推荐使用的标签</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Kubernetes%E6%9E%B6%E6%9E%84\"><span class=\"toc-text\">Kubernetes架构</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%83%A8%E7%BD%B2%E5%91%BD%E4%BB%A4%EF%BC%9A\"><span class=\"toc-text\">部署命令：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8%E5%88%B0%E7%9A%84%E9%95%9C%E5%83%8F\"><span class=\"toc-text\">使用到的镜像</span></a></li></ol></li></ol></li></ol>","author":{"name":"Moses","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一位正在重塑知识的技术人","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"软件成分分析工具评估开放指南","uid":"0f4f52fd9bba6992ed16037b649e9241","slug":"软件成分分析工具评估开放指南","date":"2022-10-26T01:08:35.000Z","updated":"2022-10-26T07:55:47.699Z","comments":true,"path":"api/articles/软件成分分析工具评估开放指南.json","keywords":null,"cover":"https://source.unsplash.com/ukzHlkoz1IE/1200x628","text":"1.介绍 借助软件成分分析（SCA）工具，软件开发团队能从许可证合规和安全漏洞角度跟踪和分析引入到项目里的任何开源代码。这样的工具发现开源代码（不同程度的细节和功能），他们直接和间接依赖、许可证有效性，和任何已知的安全漏洞及潜在的攻击。好多公司提供软件成分分析（SCA）工具套装、...","link":"","photos":[],"count_time":{"symbolsCount":"4.7k","symbolsTime":"4 mins."},"categories":[{"name":"软件供应链安全","slug":"软件供应链安全","count":26,"path":"api/categories/软件供应链安全.json"}],"tags":[{"name":"SCA","slug":"SCA","count":15,"path":"api/tags/SCA.json"},{"name":"软件成分分析","slug":"软件成分分析","count":2,"path":"api/tags/软件成分分析.json"},{"name":"产品选型","slug":"产品选型","count":6,"path":"api/tags/产品选型.json"},{"name":"评估开放指南","slug":"评估开放指南","count":1,"path":"api/tags/评估开放指南.json"}],"author":{"name":"Moses","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一位正在重塑知识的技术人","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"初识Tesseract","uid":"6787fb34a82f7c2a73dcf3247259afae","slug":"Tesseract","date":"2022-10-21T08:25:00.000Z","updated":"2022-10-27T01:19:14.056Z","comments":true,"path":"api/articles/Tesseract.json","keywords":null,"cover":"https://gtwallpaper.org/sites/default/files/wallpaper/159445/a-tunnel-8k-secret-passage-wallpapers-159445-3960-2622739.png","text":"Tesseract0x01简介tesseROCr是Python的一个OCR识别库，但其实是对tesseract做了一层Python Api的封装， 核心还是tesseract，所以在安装tesseROCr之前，需要先安装tesseract;Introduction | tessd...","link":"","photos":[],"count_time":{"symbolsCount":958,"symbolsTime":"1 mins."},"categories":[{"name":"人工智能","slug":"人工智能","count":2,"path":"api/categories/人工智能.json"}],"tags":[{"name":"OCR","slug":"OCR","count":2,"path":"api/tags/OCR.json"},{"name":"人工智能","slug":"人工智能","count":1,"path":"api/tags/人工智能.json"}],"author":{"name":"Moses","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一位正在重塑知识的技术人","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}