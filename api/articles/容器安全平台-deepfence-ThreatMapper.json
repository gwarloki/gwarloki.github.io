{"title":"容器安全平台-deepfence-ThreatMapper","uid":"f8440a3d154328a49baadf9056bbbcfd","slug":"容器安全平台-deepfence-ThreatMapper","date":"2022-04-21T03:36:00.000Z","updated":"2022-10-27T02:15:45.038Z","comments":true,"path":"api/articles/容器安全平台-deepfence-ThreatMapper.json","keywords":null,"cover":"https://gtwallpaper.org/sites/default/files/wallpaper/159422/4k-empty-road-new-wallpapers-159422-9856-8946046.png","content":"<h1 id=\"容器安全平台-deepfence\"><a href=\"#容器安全平台-deepfence\" class=\"headerlink\" title=\"容器安全平台-deepfence\"></a>容器安全平台-deepfence</h1><h2 id=\"0x01简介\"><a href=\"#0x01简介\" class=\"headerlink\" title=\"0x01简介\"></a>0x01简介</h2><p><a href=\"https://github.com/deepfence/ThreatMapper\">ThreatMapper</a> 开源云原生安全可观测性平台</p>\n<h2 id=\"0x02架构图\"><a href=\"#0x02架构图\" class=\"headerlink\" title=\"0x02架构图\"></a>0x02架构图</h2><p><img src=\"https://s2.loli.net/2022/04/21/GcrveUAYONZSsiQ.png\"><br>Deepfence Threat由两部分组成：</p>\n<ul>\n<li>Management Console:管理端包括应用拓扑、一般SBOMs漏洞、威胁地图</li>\n<li>ThreatMapper Sensor:采集器</li>\n</ul>\n<h2 id=\"0x03核心能力\"><a href=\"#0x03核心能力\" class=\"headerlink\" title=\"0x03核心能力\"></a>0x03核心能力</h2><p>略</p>\n<h2 id=\"0x04对比\"><a href=\"#0x04对比\" class=\"headerlink\" title=\"0x04对比\"></a>0x04对比</h2><p>略</p>\n<h2 id=\"0x05Quickstart\"><a href=\"#0x05Quickstart\" class=\"headerlink\" title=\"0x05Quickstart\"></a>0x05Quickstart</h2><h3 id=\"require\"><a href=\"#require\" class=\"headerlink\" title=\"require\"></a>require</h3><p>Management Console requie 4C 16G install docker &amp; docker-compose port 443<br>ThreatMapper with helm require sc [[OpenEBS.md]]</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># Install OpenEBS, and wait for it to start up\nkubectl create ns openebs\nhelm install openebs --namespace openebs --repo &quot;https:&#x2F;&#x2F;openebs.github.io&#x2F;charts&quot; openebs --set analytics.enabled&#x3D;false\nkubectl get pods -o wide --namespace openebs -w\n\n# Install the Kubernetes metrics service (if not already installed)\nkubectl apply -f https:&#x2F;&#x2F;github.com&#x2F;kubernetes-sigs&#x2F;metrics-server&#x2F;releases&#x2F;download&#x2F;v0.6.1&#x2F;components.yaml\n\n# Configure the Deepfence ThreatMapper Helm Chart\nhelm repo add deepfence https:&#x2F;&#x2F;deepfence-helm-charts.s3.amazonaws.com&#x2F;threatmapper\n\n# Install the ThreatMapper console and wait for the pods to start up\nhelm install deepfence-console deepfence&#x2F;deepfence-console\nkubectl get pods -o wide -w\n\n# Optionally, install the Deepfence Router service and wait for the platform to deploy a load balancer\nhelm install deepfence-router deepfence&#x2F;deepfence-router\nkubectl get --namespace default svc -w deepfence-router</code></pre>\n\n<h3 id=\"Management-Console-install\"><a href=\"#Management-Console-install\" class=\"headerlink\" title=\"Management Console install\"></a>Management Console install</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">sudo sysctl -w vm.max_map_count&#x3D;262144 # see https:&#x2F;&#x2F;www.elastic.co&#x2F;guide&#x2F;en&#x2F;elasticsearch&#x2F;reference&#x2F;current&#x2F;vm-max-map-count.html\n\nwget https:&#x2F;&#x2F;github.com&#x2F;deepfence&#x2F;ThreatMapper&#x2F;raw&#x2F;master&#x2F;deployment-scripts&#x2F;docker-compose.yml\ndocker-compose -f docker-compose.yml up --detach</code></pre>\n<h3 id=\"ThreatMapper-Sensor-install\"><a href=\"#ThreatMapper-Sensor-install\" class=\"headerlink\" title=\"ThreatMapper Sensor install\"></a>ThreatMapper Sensor install</h3><h4 id=\"install-with-docker\"><a href=\"#install-with-docker\" class=\"headerlink\" title=\"install with docker\"></a>install with docker</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">docker run -dit --cpus&#x3D;&quot;.2&quot; --name&#x3D;deepfence-agent --restart on-failure --pid&#x3D;host --net&#x3D;host \\\n  --privileged&#x3D;true -v &#x2F;sys&#x2F;kernel&#x2F;debug:&#x2F;sys&#x2F;kernel&#x2F;debug:rw -v &#x2F;var&#x2F;log&#x2F;fenced \\\n  -v &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock -v &#x2F;:&#x2F;fenced&#x2F;mnt&#x2F;host&#x2F;:ro \\\n  -e USER_DEFINED_TAGS&#x3D;&quot;&quot; -e MGMT_CONSOLE_URL&#x3D;&quot;---CONSOLE-IP---&quot; -e MGMT_CONSOLE_PORT&#x3D;&quot;443&quot; \\\n  -e DEEPFENCE_KEY&#x3D;&quot;---DEEPFENCE-API-KEY---&quot; \\\n  deepfenceio&#x2F;deepfence_agent_ce:latest</code></pre>\n<h4 id=\"install-with-helm\"><a href=\"#install-with-helm\" class=\"headerlink\" title=\"install with helm\"></a>install with helm</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">helm repo add deepfence https:&#x2F;&#x2F;deepfence-helm-charts.s3.amazonaws.com&#x2F;threatmapper\n\nhelm install deepfence-agent deepfence&#x2F;deepfence-agent \\\n    --set managementConsoleUrl&#x3D;---CONSOLE-IP--- \\\n    --set deepfenceKey&#x3D;---DEEPFENCE-API-KEY---</code></pre>\n\n\n<h3 id=\"check\"><a href=\"#check\" class=\"headerlink\" title=\"check\"></a>check</h3><p><img src=\"https://s2.loli.net/2022/04/21/qk4jTiG5hJE7HeW.png\"><br><img src=\"https://s2.loli.net/2022/04/21/edz1YjJCFbPyw8M.png\"></p>\n<p><img src=\"https://s2.loli.net/2022/04/21/247LSCBbjNGdxYV.png\"></p>\n<h3 id=\"进阶-intergrations\"><a href=\"#进阶-intergrations\" class=\"headerlink\" title=\"进阶-intergrations\"></a>进阶-intergrations</h3><h4 id=\"SIEM\"><a href=\"#SIEM\" class=\"headerlink\" title=\"SIEM\"></a>SIEM</h4><p><img src=\"https://s2.loli.net/2022/04/21/6GkJg2Bm1DPb9FV.png\"></p>\n<h4 id=\"Notification\"><a href=\"#Notification\" class=\"headerlink\" title=\"Notification\"></a>Notification</h4><p><img src=\"https://s2.loli.net/2022/04/21/eY5JSsRDuthprMZ.png\"></p>\n<h4 id=\"镜像扫描\"><a href=\"#镜像扫描\" class=\"headerlink\" title=\"镜像扫描\"></a>镜像扫描</h4><p><img src=\"https://s2.loli.net/2022/04/21/cIF5kt62f1mgNTy.png\"></p>\n<h4 id=\"ticketing\"><a href=\"#ticketing\" class=\"headerlink\" title=\"ticketing\"></a>ticketing</h4><p><img src=\"https://s2.loli.net/2022/04/21/3zsDcnBMEjqd9tK.png\"></p>\n<h4 id=\"report\"><a href=\"#report\" class=\"headerlink\" title=\"report\"></a>report</h4><p><img src=\"https://s2.loli.net/2022/04/21/dQcVmu8h6NyGLzY.png\"></p>\n","text":"容器安全平台-deepfence0x01简介ThreatMapper 开源云原生安全可观测性平台 0x02架构图Deepfence Threat由两部分组成： Management Console:管理端包括应用拓扑、一般SBOMs漏洞、威胁地图 ThreatMapper Sen...","link":"","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[{"name":"Cloud-Native-Security","slug":"Cloud-Native-Security","count":12,"path":"api/categories/Cloud-Native-Security.json"}],"tags":[{"name":"容器安全平台","slug":"容器安全平台","count":5,"path":"api/tags/容器安全平台.json"},{"name":"产品选型","slug":"产品选型","count":6,"path":"api/tags/产品选型.json"},{"name":"开源云原生安全","slug":"开源云原生安全","count":1,"path":"api/tags/开源云原生安全.json"},{"name":"DeepFence","slug":"DeepFence","count":1,"path":"api/tags/DeepFence.json"},{"name":"云原生威胁地图","slug":"云原生威胁地图","count":1,"path":"api/tags/云原生威胁地图.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0-deepfence\"><span class=\"toc-text\">容器安全平台-deepfence</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x01%E7%AE%80%E4%BB%8B\"><span class=\"toc-text\">0x01简介</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x02%E6%9E%B6%E6%9E%84%E5%9B%BE\"><span class=\"toc-text\">0x02架构图</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x03%E6%A0%B8%E5%BF%83%E8%83%BD%E5%8A%9B\"><span class=\"toc-text\">0x03核心能力</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x04%E5%AF%B9%E6%AF%94\"><span class=\"toc-text\">0x04对比</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x05Quickstart\"><span class=\"toc-text\">0x05Quickstart</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#require\"><span class=\"toc-text\">require</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Management-Console-install\"><span class=\"toc-text\">Management Console install</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#ThreatMapper-Sensor-install\"><span class=\"toc-text\">ThreatMapper Sensor install</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#install-with-docker\"><span class=\"toc-text\">install with docker</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#install-with-helm\"><span class=\"toc-text\">install with helm</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#check\"><span class=\"toc-text\">check</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%9B%E9%98%B6-intergrations\"><span class=\"toc-text\">进阶-intergrations</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#SIEM\"><span class=\"toc-text\">SIEM</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Notification\"><span class=\"toc-text\">Notification</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%95%9C%E5%83%8F%E6%89%AB%E6%8F%8F\"><span class=\"toc-text\">镜像扫描</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#ticketing\"><span class=\"toc-text\">ticketing</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#report\"><span class=\"toc-text\">report</span></a></li></ol></li></ol></li></ol></li></ol>","author":{"name":"Moses","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一位正在重塑知识的技术人","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"熔断、超时、限流和服务降级的概念梳理","uid":"413e999854a8918e45b13a69d229a398","slug":"熔断、超时、限流和服务降级","date":"2022-05-05T07:42:08.000Z","updated":"2022-10-27T03:00:16.565Z","comments":true,"path":"api/articles/熔断、超时、限流和服务降级.json","keywords":null,"cover":"https://gtwallpaper.org/sites/default/files/wallpaper/159416/4k-beneath-the-clouds-wallpapers-159416-910142-2825240.png","text":"服务熔断解决的问题 解决微服务架构下，系统间调用链路的雪崩，避免造成整个微服务体系崩溃。类似电路过载的保险丝。 技术、架构类问题的解决方案，多数研发和运维参与。 从局部出发，各自解决问题，被动防御。 造成链路调用雪崩的原因 调用链的某一环节，例如APP-D出现性能瓶颈，导致依赖该...","link":"","photos":[],"count_time":{"symbolsCount":"1.4k","symbolsTime":"1 mins."},"categories":[{"name":"分布式","slug":"分布式","count":6,"path":"api/categories/分布式.json"},{"name":"微服务","slug":"分布式/微服务","count":3,"path":"api/categories/分布式/微服务.json"}],"tags":[{"name":"服务限流","slug":"服务限流","count":2,"path":"api/tags/服务限流.json"},{"name":"服务熔断","slug":"服务熔断","count":1,"path":"api/tags/服务熔断.json"},{"name":"服务降级","slug":"服务降级","count":1,"path":"api/tags/服务降级.json"}],"author":{"name":"Moses","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一位正在重塑知识的技术人","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"容器安全-针对容器的渗透测试方法","uid":"187ba77175374873452e35cc1b1a9ffe","slug":"针对容器的渗透测试方法","date":"2022-04-11T03:36:00.000Z","updated":"2022-10-27T02:29:32.680Z","comments":true,"path":"api/articles/针对容器的渗透测试方法.json","keywords":null,"cover":"https://gtwallpaper.org/sites/default/files/wallpaper/159415/4k-beautiful-sunrise-reflection-wallpapers-159415-2155406-2770784.png","text":"攻击者模型攻击者模型容器逃逸和针对Docker守护进程的攻击，分别对应位于容器内部的攻击者和位于运行了Docker守护进程的宿主机上的攻击者。 其中，容器逃逸包括容器内进程影响到宿主机或其他容器两种情况，示意图如下： 针对Docker守护进程的攻击则指宿主机上低权限攻击者借助Do...","link":"","photos":[],"count_time":{"symbolsCount":"5.2k","symbolsTime":"5 mins."},"categories":[{"name":"Cloud-Native-Security","slug":"Cloud-Native-Security","count":12,"path":"api/categories/Cloud-Native-Security.json"}],"tags":[{"name":"容器安全","slug":"容器安全","count":3,"path":"api/tags/容器安全.json"},{"name":"优秀文章收藏","slug":"优秀文章收藏","count":5,"path":"api/tags/优秀文章收藏.json"},{"name":"渗透测试","slug":"渗透测试","count":1,"path":"api/tags/渗透测试.json"}],"author":{"name":"Moses","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一位正在重塑知识的技术人","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}